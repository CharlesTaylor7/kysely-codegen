"use strict";var ca=Object.create;var si=Object.defineProperty;var pa=Object.getOwnPropertyDescriptor;var la=Object.getOwnPropertyNames;var ma=Object.getPrototypeOf,ha=Object.prototype.hasOwnProperty;var K=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),fa=(t,e)=>{for(var r in e)si(t,r,{get:e[r],enumerable:!0})},wn=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of la(e))!ha.call(t,n)&&n!==r&&si(t,n,{get:()=>e[n],enumerable:!(o=pa(e,n))||o.enumerable});return t};var xn=(t,e,r)=>(r=t!=null?ca(ma(t)):{},wn(e||!t||!t.__esModule?si(r,"default",{value:t,enumerable:!0}):r,t)),Na=t=>wn(si({},"__esModule",{value:!0}),t);var En=K((Gd,On)=>{"use strict";function ya(t,e){var r=t;e.slice(0,-1).forEach(function(n){r=r[n]||{}});var o=e[e.length-1];return o in r}function gn(t){return typeof t=="number"||/^0x[0-9a-f]+$/i.test(t)?!0:/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(t)}function bn(t,e){return e==="constructor"&&typeof t[e]=="function"||e==="__proto__"}On.exports=function(t,e){e||(e={});var r={bools:{},strings:{},unknownFn:null};typeof e.unknown=="function"&&(r.unknownFn=e.unknown),typeof e.boolean=="boolean"&&e.boolean?r.allBools=!0:[].concat(e.boolean).filter(Boolean).forEach(function(g){r.bools[g]=!0});var o={};function n(g){return o[g].some(function(B){return r.bools[B]})}Object.keys(e.alias||{}).forEach(function(g){o[g]=[].concat(e.alias[g]),o[g].forEach(function(B){o[B]=[g].concat(o[g].filter(function(Le){return B!==Le}))})}),[].concat(e.string).filter(Boolean).forEach(function(g){r.strings[g]=!0,o[g]&&[].concat(o[g]).forEach(function(B){r.strings[B]=!0})});var s=e.default||{},a={_:[]};function u(g,B){return r.allBools&&/^--[^=]+$/.test(B)||r.strings[g]||r.bools[g]||o[g]}function d(g,B,Le){for(var S=g,er=0;er<B.length-1;er++){var Oe=B[er];if(bn(S,Oe))return;S[Oe]===void 0&&(S[Oe]={}),(S[Oe]===Object.prototype||S[Oe]===Number.prototype||S[Oe]===String.prototype)&&(S[Oe]={}),S[Oe]===Array.prototype&&(S[Oe]=[]),S=S[Oe]}var Pe=B[B.length-1];bn(S,Pe)||((S===Object.prototype||S===Number.prototype||S===String.prototype)&&(S={}),S===Array.prototype&&(S=[]),S[Pe]===void 0||r.bools[Pe]||typeof S[Pe]=="boolean"?S[Pe]=Le:Array.isArray(S[Pe])?S[Pe].push(Le):S[Pe]=[S[Pe],Le])}function c(g,B,Le){if(!(Le&&r.unknownFn&&!u(g,Le)&&r.unknownFn(Le)===!1)){var S=!r.strings[g]&&gn(B)?Number(B):B;d(a,g.split("."),S),(o[g]||[]).forEach(function(er){d(a,er.split("."),S)})}}Object.keys(r.bools).forEach(function(g){c(g,s[g]===void 0?!1:s[g])});var y=[];t.indexOf("--")!==-1&&(y=t.slice(t.indexOf("--")+1),t=t.slice(0,t.indexOf("--")));for(var f=0;f<t.length;f++){var h=t[f],x,F;if(/^--.+=/.test(h)){var be=h.match(/^--([^=]+)=([\s\S]*)$/);x=be[1];var $e=be[2];r.bools[x]&&($e=$e!=="false"),c(x,$e,h)}else if(/^--no-.+/.test(h))x=h.match(/^--no-(.+)/)[1],c(x,!1,h);else if(/^--.+/.test(h))x=h.match(/^--(.+)/)[1],F=t[f+1],F!==void 0&&!/^(-|--)[^-]/.test(F)&&!r.bools[x]&&!r.allBools&&(!o[x]||!n(x))?(c(x,F,h),f+=1):/^(true|false)$/.test(F)?(c(x,F==="true",h),f+=1):c(x,r.strings[x]?"":!0,h);else if(/^-[^-]+/.test(h)){for(var k=h.slice(1,-1).split(""),ke=!1,O=0;O<k.length;O++){if(F=h.slice(O+2),F==="-"){c(k[O],F,h);continue}if(/[A-Za-z]/.test(k[O])&&F[0]==="="){c(k[O],F.slice(1),h),ke=!0;break}if(/[A-Za-z]/.test(k[O])&&/-?\d+(\.\d*)?(e-?\d+)?$/.test(F)){c(k[O],F,h),ke=!0;break}if(k[O+1]&&k[O+1].match(/\W/)){c(k[O],h.slice(O+2),h),ke=!0;break}else c(k[O],r.strings[k[O]]?"":!0,h)}x=h.slice(-1)[0],!ke&&x!=="-"&&(t[f+1]&&!/^(-|--)[^-]/.test(t[f+1])&&!r.bools[x]&&(!o[x]||!n(x))?(c(x,t[f+1],h),f+=1):t[f+1]&&/^(true|false)$/.test(t[f+1])?(c(x,t[f+1]==="true",h),f+=1):c(x,r.strings[x]?"":!0,h))}else if((!r.unknownFn||r.unknownFn(h)!==!1)&&a._.push(r.strings._||!gn(h)?h:Number(h)),e.stopEarly){a._.push.apply(a._,t.slice(f+1));break}}return Object.keys(s).forEach(function(g){ya(a,g.split("."))||(d(a,g.split("."),s[g]),(o[g]||[]).forEach(function(B){d(a,B.split("."),s[g])}))}),e["--"]?a["--"]=y.slice():y.forEach(function(g){a._.push(g)}),a}});var Re=K(so=>{"use strict";so.getBooleanOption=(t,e)=>{let r=!1;if(e in t&&typeof(r=t[e])!="boolean")throw new TypeError(`Expected the "${e}" option to be a boolean`);return r};so.cppdb=Symbol();so.inspect=Symbol.for("nodejs.util.inspect.custom")});var on=K((wC,vs)=>{"use strict";var rn={value:"SqliteError",writable:!0,enumerable:!1,configurable:!0};function Nt(t,e){if(new.target!==Nt)return new Nt(t,e);if(typeof e!="string")throw new TypeError("Expected second argument to be a string");Error.call(this,t),rn.value=""+t,Object.defineProperty(this,"message",rn),Error.captureStackTrace(this,Nt),this.code=e}Object.setPrototypeOf(Nt,Error);Object.setPrototypeOf(Nt.prototype,Error.prototype);Object.defineProperty(Nt.prototype,"name",rn);vs.exports=Nt});var As=K((xC,Ss)=>{var ao=require("path").sep||"/";Ss.exports=tu;function tu(t){if(typeof t!="string"||t.length<=7||t.substring(0,7)!="file://")throw new TypeError("must pass in a file:// URI to convert to a file path");var e=decodeURI(t.substring(7)),r=e.indexOf("/"),o=e.substring(0,r),n=e.substring(r+1);return o=="localhost"&&(o=""),o&&(o=ao+ao+o),n=n.replace(/^(.+)\|/,"$1:"),ao=="\\"&&(n=n.replace(/\//g,"\\")),/^.+\:/.test(n)||(n=ao+n),o+n}});var Rs=K((Gt,Ds)=>{var nn=require("fs"),co=require("path"),ru=As(),uo=co.join,iu=co.dirname,Ws=nn.accessSync&&function(t){try{nn.accessSync(t)}catch{return!1}return!0}||nn.existsSync||co.existsSync,qs={arrow:process.env.NODE_BINDINGS_ARROW||" \u2192 ",compiled:process.env.NODE_BINDINGS_COMPILED_DIR||"compiled",platform:process.platform,arch:process.arch,nodePreGyp:"node-v"+process.versions.modules+"-"+process.platform+"-"+process.arch,version:process.versions.node,bindings:"bindings.node",try:[["module_root","build","bindings"],["module_root","build","Debug","bindings"],["module_root","build","Release","bindings"],["module_root","out","Debug","bindings"],["module_root","Debug","bindings"],["module_root","out","Release","bindings"],["module_root","Release","bindings"],["module_root","build","default","bindings"],["module_root","compiled","version","platform","arch","bindings"],["module_root","addon-build","release","install-root","bindings"],["module_root","addon-build","debug","install-root","bindings"],["module_root","addon-build","default","install-root","bindings"],["module_root","lib","binding","nodePreGyp","bindings"]]};function ou(t){typeof t=="string"?t={bindings:t}:t||(t={}),Object.keys(qs).map(function(d){d in t||(t[d]=qs[d])}),t.module_root||(t.module_root=Gt.getRoot(Gt.getFileName())),co.extname(t.bindings)!=".node"&&(t.bindings+=".node");for(var e=typeof __webpack_require__=="function"?__non_webpack_require__:require,r=[],o=0,n=t.try.length,s,a,u;o<n;o++){s=uo.apply(null,t.try[o].map(function(d){return t[d]||d})),r.push(s);try{return a=t.path?e.resolve(s):e(s),t.path||(a.path=s),a}catch(d){if(d.code!=="MODULE_NOT_FOUND"&&d.code!=="QUALIFIED_PATH_RESOLUTION_FAILED"&&!/not find/i.test(d.message))throw d}}throw u=new Error(`Could not locate the bindings file. Tried:
`+r.map(function(d){return t.arrow+d}).join(`
`)),u.tries=r,u}Ds.exports=Gt=ou;Gt.getFileName=function(e){var r=Error.prepareStackTrace,o=Error.stackTraceLimit,n={},s;Error.stackTraceLimit=10,Error.prepareStackTrace=function(u,d){for(var c=0,y=d.length;c<y;c++)if(s=d[c].getFileName(),s!==__filename)if(e){if(s!==e)return}else return},Error.captureStackTrace(n),n.stack,Error.prepareStackTrace=r,Error.stackTraceLimit=o;var a="file://";return s.indexOf(a)===0&&(s=ru(s)),s};Gt.getRoot=function(e){for(var r=iu(e),o;;){if(r==="."&&(r=process.cwd()),Ws(uo(r,"package.json"))||Ws(uo(r,"node_modules")))return r;if(o===r)throw new Error('Could not find module root given file: "'+e+'". Do you have a `package.json` file? ');o=r,r=uo(r,"..")}}});var ks=K(nt=>{"use strict";var{cppdb:ge}=Re();nt.prepare=function(e){return this[ge].prepare(e,this,!1)};nt.exec=function(e){return this[ge].exec(e),this};nt.close=function(){return this[ge].close(),this};nt.loadExtension=function(...e){return this[ge].loadExtension(...e),this};nt.defaultSafeIntegers=function(...e){return this[ge].defaultSafeIntegers(...e),this};nt.unsafeMode=function(...e){return this[ge].unsafeMode(...e),this};nt.getters={name:{get:function(){return this[ge].name},enumerable:!0},open:{get:function(){return this[ge].open},enumerable:!0},inTransaction:{get:function(){return this[ge].inTransaction},enumerable:!0},readonly:{get:function(){return this[ge].readonly},enumerable:!0},memory:{get:function(){return this[ge].memory},enumerable:!0}}});var Bs=K((bC,Ps)=>{"use strict";var{cppdb:nu}=Re(),Ls=new WeakMap;Ps.exports=function(e){if(typeof e!="function")throw new TypeError("Expected first argument to be a function");let r=this[nu],o=su(r,this),{apply:n}=Function.prototype,s={default:{value:po(n,e,r,o.default)},deferred:{value:po(n,e,r,o.deferred)},immediate:{value:po(n,e,r,o.immediate)},exclusive:{value:po(n,e,r,o.exclusive)},database:{value:this,enumerable:!0}};return Object.defineProperties(s.default.value,s),Object.defineProperties(s.deferred.value,s),Object.defineProperties(s.immediate.value,s),Object.defineProperties(s.exclusive.value,s),s.default.value};var su=(t,e)=>{let r=Ls.get(t);if(!r){let o={commit:t.prepare("COMMIT",e,!1),rollback:t.prepare("ROLLBACK",e,!1),savepoint:t.prepare("SAVEPOINT `	_bs3.	`",e,!1),release:t.prepare("RELEASE `	_bs3.	`",e,!1),rollbackTo:t.prepare("ROLLBACK TO `	_bs3.	`",e,!1)};Ls.set(t,r={default:Object.assign({begin:t.prepare("BEGIN",e,!1)},o),deferred:Object.assign({begin:t.prepare("BEGIN DEFERRED",e,!1)},o),immediate:Object.assign({begin:t.prepare("BEGIN IMMEDIATE",e,!1)},o),exclusive:Object.assign({begin:t.prepare("BEGIN EXCLUSIVE",e,!1)},o)})}return r},po=(t,e,r,{begin:o,commit:n,rollback:s,savepoint:a,release:u,rollbackTo:d})=>function(){let y,f,h;r.inTransaction?(y=a,f=u,h=d):(y=o,f=n,h=s),y.run();try{let x=t.call(e,this,arguments);return f.run(),x}catch(x){throw r.inTransaction&&(h.run(),h!==s&&f.run()),x}}});var Fs=K((OC,Ms)=>{"use strict";var{getBooleanOption:au,cppdb:uu}=Re();Ms.exports=function(e,r){if(r==null&&(r={}),typeof e!="string")throw new TypeError("Expected first argument to be a string");if(typeof r!="object")throw new TypeError("Expected second argument to be an options object");let o=au(r,"simple"),n=this[uu].prepare(`PRAGMA ${e}`,this,!0);return o?n.pluck().get():n.all()}});var Qs=K((EC,zs)=>{"use strict";var du=require("fs"),cu=require("path"),{promisify:pu}=require("util"),{cppdb:lu}=Re(),Us=pu(du.access);zs.exports=async function(e,r){if(r==null&&(r={}),typeof e!="string")throw new TypeError("Expected first argument to be a string");if(typeof r!="object")throw new TypeError("Expected second argument to be an options object");e=e.trim();let o="attached"in r?r.attached:"main",n="progress"in r?r.progress:null;if(!e)throw new TypeError("Backup filename cannot be an empty string");if(e===":memory:")throw new TypeError('Invalid backup filename ":memory:"');if(typeof o!="string")throw new TypeError('Expected the "attached" option to be a string');if(!o)throw new TypeError('The "attached" option cannot be an empty string');if(n!=null&&typeof n!="function")throw new TypeError('Expected the "progress" option to be a function');await Us(cu.dirname(e)).catch(()=>{throw new TypeError("Cannot save backup because the directory does not exist")});let s=await Us(e).then(()=>!1,()=>!0);return mu(this[lu].backup(this,o,e,s),n||null)};var mu=(t,e)=>{let r=0,o=!0;return new Promise((n,s)=>{setImmediate(function a(){try{let u=t.transfer(r);if(!u.remainingPages){t.close(),n(u);return}if(o&&(o=!1,r=100),e){let d=e(u);if(d!==void 0)if(typeof d=="number"&&d===d)r=Math.max(0,Math.min(2147483647,Math.round(d)));else throw new TypeError("Expected progress callback to return a number or undefined")}setImmediate(a)}catch(u){t.close(),s(u)}})})}});var $s=K((TC,Vs)=>{"use strict";var{cppdb:hu}=Re();Vs.exports=function(e){if(e==null&&(e={}),typeof e!="object")throw new TypeError("Expected first argument to be an options object");let r="attached"in e?e.attached:"main";if(typeof r!="string")throw new TypeError('Expected the "attached" option to be a string');if(!r)throw new TypeError('The "attached" option cannot be an empty string');return this[hu].serialize(r)}});var js=K((IC,Js)=>{"use strict";var{getBooleanOption:lo,cppdb:fu}=Re();Js.exports=function(e,r,o){if(r==null&&(r={}),typeof r=="function"&&(o=r,r={}),typeof e!="string")throw new TypeError("Expected first argument to be a string");if(typeof o!="function")throw new TypeError("Expected last argument to be a function");if(typeof r!="object")throw new TypeError("Expected second argument to be an options object");if(!e)throw new TypeError("User-defined function name cannot be an empty string");let n="safeIntegers"in r?+lo(r,"safeIntegers"):2,s=lo(r,"deterministic"),a=lo(r,"directOnly"),u=lo(r,"varargs"),d=-1;if(!u){if(d=o.length,!Number.isInteger(d)||d<0)throw new TypeError("Expected function.length to be a positive integer");if(d>100)throw new RangeError("User-defined functions cannot have more than 100 arguments")}return this[fu].function(o,e,d,n,s,a),this}});var Xs=K((CC,Gs)=>{"use strict";var{getBooleanOption:mo,cppdb:Nu}=Re();Gs.exports=function(e,r){if(typeof e!="string")throw new TypeError("Expected first argument to be a string");if(typeof r!="object"||r===null)throw new TypeError("Expected second argument to be an options object");if(!e)throw new TypeError("User-defined function name cannot be an empty string");let o="start"in r?r.start:null,n=sn(r,"step",!0),s=sn(r,"inverse",!1),a=sn(r,"result",!1),u="safeIntegers"in r?+mo(r,"safeIntegers"):2,d=mo(r,"deterministic"),c=mo(r,"directOnly"),y=mo(r,"varargs"),f=-1;if(!y&&(f=Math.max(Ks(n),s?Ks(s):0),f>0&&(f-=1),f>100))throw new RangeError("User-defined functions cannot have more than 100 arguments");return this[Nu].aggregate(o,n,s,a,e,f,u,d,c),this};var sn=(t,e,r)=>{let o=e in t?t[e]:null;if(typeof o=="function")return o;if(o!=null)throw new TypeError(`Expected the "${e}" option to be a function`);if(r)throw new TypeError(`Missing required option "${e}"`);return null},Ks=({length:t})=>{if(Number.isInteger(t)&&t>=0)return t;throw new TypeError("Expected function.length to be a positive integer")}});var Zs=K((vC,Hs)=>{"use strict";var{cppdb:yu}=Re();Hs.exports=function(e,r){if(typeof e!="string")throw new TypeError("Expected first argument to be a string");if(!e)throw new TypeError("Virtual table module name cannot be an empty string");let o=!1;if(typeof r=="object"&&r!==null)o=!0,r=Iu(Ys(r,"used",e));else{if(typeof r!="function")throw new TypeError("Expected second argument to be a function or a table definition object");r=wu(r)}return this[yu].table(r,e,o),this};function wu(t){return function(r,o,n,...s){let a={module:r,database:o,table:n},u=Eu.call(t,a,s);if(typeof u!="object"||u===null)throw new TypeError(`Virtual table module "${r}" did not return a table definition object`);return Ys(u,"returned",r)}}function Ys(t,e,r){if(!Xr.call(t,"rows"))throw new TypeError(`Virtual table module "${r}" ${e} a table definition without a "rows" property`);if(!Xr.call(t,"columns"))throw new TypeError(`Virtual table module "${r}" ${e} a table definition without a "columns" property`);let o=t.rows;if(typeof o!="function"||Object.getPrototypeOf(o)!==Tu)throw new TypeError(`Virtual table module "${r}" ${e} a table definition with an invalid "rows" property (should be a generator function)`);let n=t.columns;if(!Array.isArray(n)||!(n=[...n]).every(c=>typeof c=="string"))throw new TypeError(`Virtual table module "${r}" ${e} a table definition with an invalid "columns" property (should be an array of strings)`);if(n.length!==new Set(n).size)throw new TypeError(`Virtual table module "${r}" ${e} a table definition with duplicate column names`);if(!n.length)throw new RangeError(`Virtual table module "${r}" ${e} a table definition with zero columns`);let s;if(Xr.call(t,"parameters")){if(s=t.parameters,!Array.isArray(s)||!(s=[...s]).every(c=>typeof c=="string"))throw new TypeError(`Virtual table module "${r}" ${e} a table definition with an invalid "parameters" property (should be an array of strings)`)}else s=Ou(o);if(s.length!==new Set(s).size)throw new TypeError(`Virtual table module "${r}" ${e} a table definition with duplicate parameter names`);if(s.length>32)throw new RangeError(`Virtual table module "${r}" ${e} a table definition with more than the maximum number of 32 parameters`);for(let c of s)if(n.includes(c))throw new TypeError(`Virtual table module "${r}" ${e} a table definition with column "${c}" which was ambiguously defined as both a column and parameter`);let a=2;if(Xr.call(t,"safeIntegers")){let c=t.safeIntegers;if(typeof c!="boolean")throw new TypeError(`Virtual table module "${r}" ${e} a table definition with an invalid "safeIntegers" property (should be a boolean)`);a=+c}let u=!1;if(Xr.call(t,"directOnly")&&(u=t.directOnly,typeof u!="boolean"))throw new TypeError(`Virtual table module "${r}" ${e} a table definition with an invalid "directOnly" property (should be a boolean)`);return[`CREATE TABLE x(${[...s.map(_s).map(c=>`${c} HIDDEN`),...n.map(_s)].join(", ")});`,xu(o,new Map(n.map((c,y)=>[c,s.length+y])),r),s,a,u]}function xu(t,e,r){return function*(...n){let s=n.map(a=>Buffer.isBuffer(a)?Buffer.from(a):a);for(let a=0;a<e.size;++a)s.push(null);for(let a of t(...n))if(Array.isArray(a))gu(a,s,e.size,r),yield s;else if(typeof a=="object"&&a!==null)bu(a,s,e,r),yield s;else throw new TypeError(`Virtual table module "${r}" yielded something that isn't a valid row object`)}}function gu(t,e,r,o){if(t.length!==r)throw new TypeError(`Virtual table module "${o}" yielded a row with an incorrect number of columns`);let n=e.length-r;for(let s=0;s<r;++s)e[s+n]=t[s]}function bu(t,e,r,o){let n=0;for(let s of Object.keys(t)){let a=r.get(s);if(a===void 0)throw new TypeError(`Virtual table module "${o}" yielded a row with an undeclared column "${s}"`);e[a]=t[s],n+=1}if(n!==r.size)throw new TypeError(`Virtual table module "${o}" yielded a row with missing columns`)}function Ou({length:t}){if(!Number.isInteger(t)||t<0)throw new TypeError("Expected function.length to be a positive integer");let e=[];for(let r=0;r<t;++r)e.push(`$${r+1}`);return e}var{hasOwnProperty:Xr}=Object.prototype,{apply:Eu}=Function.prototype,Tu=Object.getPrototypeOf(function*(){}),_s=t=>`"${t.replace(/"/g,'""')}"`,Iu=t=>()=>t});var ta=K((SC,ea)=>{"use strict";var Cu=function(){};ea.exports=function(e,r){return Object.assign(new Cu,this)}});var na=K((AC,oa)=>{"use strict";var vu=require("fs"),ra=require("path"),ho=Re(),Su=on(),ia;function ee(t,e){if(new.target==null)return new ee(t,e);let r;if(Buffer.isBuffer(t)&&(r=t,t=":memory:"),t==null&&(t=""),e==null&&(e={}),typeof t!="string")throw new TypeError("Expected first argument to be a string");if(typeof e!="object")throw new TypeError("Expected second argument to be an options object");if("readOnly"in e)throw new TypeError('Misspelled option "readOnly" should be "readonly"');if("memory"in e)throw new TypeError('Option "memory" was removed in v7.0.0 (use ":memory:" filename instead)');let o=t.trim(),n=o===""||o===":memory:",s=ho.getBooleanOption(e,"readonly"),a=ho.getBooleanOption(e,"fileMustExist"),u="timeout"in e?e.timeout:5e3,d="verbose"in e?e.verbose:null,c="nativeBinding"in e?e.nativeBinding:null;if(s&&n&&!r)throw new TypeError("In-memory/temporary databases cannot be readonly");if(!Number.isInteger(u)||u<0)throw new TypeError('Expected the "timeout" option to be a positive integer');if(u>2147483647)throw new RangeError('Option "timeout" cannot be greater than 2147483647');if(d!=null&&typeof d!="function")throw new TypeError('Expected the "verbose" option to be a function');if(c!=null&&typeof c!="string"&&typeof c!="object")throw new TypeError('Expected the "nativeBinding" option to be a string or addon object');let y;if(c==null?y=ia||(ia=Rs()("better_sqlite3.node")):typeof c=="string"?y=(typeof __non_webpack_require__=="function"?__non_webpack_require__:require)(ra.resolve(c).replace(/(\.node)?$/,".node")):y=c,y.isInitialized||(y.setErrorConstructor(Su),y.isInitialized=!0),!n&&!vu.existsSync(ra.dirname(o)))throw new TypeError("Cannot open database because the directory does not exist");Object.defineProperties(this,{[ho.cppdb]:{value:new y.Database(o,t,n,s,a,u,d||null,r||null)},...yt.getters})}var yt=ks();ee.prototype.prepare=yt.prepare;ee.prototype.transaction=Bs();ee.prototype.pragma=Fs();ee.prototype.backup=Qs();ee.prototype.serialize=$s();ee.prototype.function=js();ee.prototype.aggregate=Xs();ee.prototype.table=Zs();ee.prototype.loadExtension=yt.loadExtension;ee.prototype.exec=yt.exec;ee.prototype.close=yt.close;ee.prototype.defaultSafeIntegers=yt.defaultSafeIntegers;ee.prototype.unsafeMode=yt.unsafeMode;ee.prototype[ho.inspect]=ta();oa.exports=ee});var sa=K((WC,an)=>{"use strict";an.exports=na();an.exports.SqliteError=on()});var Pu={};fa(Pu,{Adapter:()=>ur,AliasDeclarationNode:()=>tr,ArrayExpressionNode:()=>ne,Cli:()=>yn,ColumnMetadata:()=>Zr,ColumnType:()=>No,ConnectionStringParser:()=>dr,DEFAULT_LOG_LEVEL:()=>Nn,DEFAULT_OUT_FILE:()=>ni,DEFAULT_URL:()=>Ht,DatabaseMetadata:()=>Gr,Dialect:()=>cr,DialectManager:()=>Yr,EnumCollection:()=>Kr,ExportStatementNode:()=>Je,ExtendsClauseNode:()=>st,FLAGS:()=>fo,GLOBAL_DEFINITIONS:()=>cn,GLOBAL_IMPORTS:()=>pn,Generator:()=>oi,GenericExpressionNode:()=>G,IdentifierNode:()=>m,ImportClauseNode:()=>rr,ImportStatementNode:()=>ir,InferClauseNode:()=>le,InterfaceDeclarationNode:()=>wt,Introspector:()=>jr,JSON_ARRAY_DEFINITION:()=>Au,JSON_DEFINITION:()=>Ru,JSON_OBJECT_DEFINITION:()=>Wu,JSON_PRIMITIVE_DEFINITION:()=>qu,JSON_VALUE_DEFINITION:()=>Du,LOG_LEVEL_NAMES:()=>Lu,LiteralNode:()=>or,LogLevel:()=>Hr,Logger:()=>Xt,MappedTypeNode:()=>nr,ModuleReferenceNode:()=>sr,NodeType:()=>P,ObjectExpressionNode:()=>xt,PropertyNode:()=>gt,RuntimeEnumDeclarationNode:()=>ar,Serializer:()=>ii,SqliteAdapter:()=>pr,SqliteDialect:()=>_r,SymbolCollection:()=>ti,SymbolType:()=>ln,TableMetadata:()=>ei,TemplateNode:()=>at,Transformer:()=>ri,UnionExpressionNode:()=>Ee,VALID_DIALECTS:()=>Zt,toCamelCase:()=>_t,toPascalCase:()=>dn});module.exports=Na(Pu);var P=(O=>(O.ALIAS_DECLARATION="AliasDeclaration",O.ARRAY_EXPRESSION="ArrayExpression",O.EXPORT_STATEMENT="ExportStatement",O.EXTENDS_CLAUSE="ExtendsClause",O.GENERIC_EXPRESSION="GenericExpression",O.IDENTIFIER="Identifier",O.IMPORT_CLAUSE="ImportClause",O.IMPORT_STATEMENT="ImportStatement",O.INFER_CLAUSE="InferClause",O.INTERFACE_DECLARATION="InterfaceDeclaration",O.LITERAL="Literal",O.MAPPED_TYPE="MappedType",O.MODULE_REFERENCE="ModuleReference",O.OBJECT_EXPRESSION="ObjectExpression",O.PROPERTY="Property",O.RUNTIME_ENUM_DECLARATION="RuntimeEnumDeclaration",O.TEMPLATE="Template",O.UNION_EXPRESSION="UnionExpression",O.VALUE="Value",O))(P||{});var tr=class{constructor(e,r){this.type="AliasDeclaration";this.name=e,this.body=r}};var ne=class{constructor(e){this.type="ArrayExpression";this.values=e}};var G=class{constructor(e,r){this.type="GenericExpression";this.name=e,this.args=r}};var No=class extends G{constructor(e,r=e,o=r){super("ColumnType",[e,r,o])}};var Je=class{constructor(e){this.type="ExportStatement";this.argument=e}};var st=class{constructor(e,r,o,n){this.type="ExtendsClause";this.checkType=e,this.extendsType=r,this.trueType=o,this.falseType=n}};var m=class{constructor(e){this.type="Identifier";this.name=e}};var rr=class{constructor(e,r=null){this.type="ImportClause";this.name=e,this.alias=r}};var ir=class{constructor(e,r){this.type="ImportStatement";this.moduleName=e,this.imports=r}};var le=class{constructor(e){this.type="InferClause";this.name=e}};var wt=class{constructor(e,r){this.type="InterfaceDeclaration";this.name=e,this.body=r}};var or=class{constructor(e){this.type="Literal";this.value=e}};var nr=class{constructor(e){this.type="MappedType";this.value=e}};var sr=class{constructor(e){this.type="ModuleReference";this.name=e}};var xt=class{constructor(e){this.type="ObjectExpression";this.properties=e}};var gt=class{constructor(e,r,o=null){this.type="Property";this.comment=o,this.key=e,this.value=r}};var ar=class{constructor(e,r){this.type="RuntimeEnumDeclaration";this.name=e,this.body=r}};var at=class{constructor(e,r){this.type="Template";this.params=e,this.expression=r}};var Ee=class{constructor(e){this.type="UnionExpression";this.args=e}};var da=xn(En());var ur=class{constructor(){this.defaultScalar=new m("unknown");this.defaultSchema=null;this.definitions={};this.imports={};this.scalars={}}};var wa=/^\s*([a-z]+)\s*\(\s*(.*)\s*\)\s*$/,xa=/([^:]*)(.*)/,dr=class{#e(e){return"sqlite"}parse(e){let r=e.connectionString,o=r.match(wa);if(o){let c=o[1];if(c!=="env")throw new ReferenceError(`Function '${c}' is not defined.`);let y=o[2],f;try{f=y.includes('"')?JSON.parse(y):y}catch{throw new SyntaxError(`Invalid connection string: '${r}'`)}if(typeof f!="string")throw new TypeError(`Parameter 0 of function '${c}' must be a string.`);let h=process.env[f];if(!h)throw new ReferenceError(`Environment variable '${f}' could not be found.`);r=h}let n=r.match(xa),s=n[1],a=n[2],u=s==="pg"?`postgres${a}`:r,d=e.dialectName??this.#e(r);return{connectionString:u,inferredDialectName:d}}};var cr=class{};var pr=class extends ur{constructor(){super(...arguments);this.defaultScalar=new m("string");this.scalars={any:new m("unknown"),blob:new m("Buffer"),boolean:new m("number"),integer:new m("number"),numeric:new m("number"),real:new m("number"),text:new m("string")}}};function se(t){return typeof t>"u"||t===void 0}function L(t){return typeof t=="string"}function je(t){return typeof t=="number"}function ut(t){return typeof t=="boolean"}function bt(t){return t===null}function Tn(t){return t instanceof Date}function Ot(t){return typeof t=="bigint"}function q(t){return typeof t=="function"}function X(t){return typeof t=="object"&&t!==null}function In(t){if(!X(t)||ba(t)!=="[object Object]")return!1;if(Object.getPrototypeOf(t)===null)return!0;let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function i(t){return Object.freeze(t)}function lr(t){return _(t)?t:[t]}function _(t){return Array.isArray(t)}function Te(t){return t}var ga=Object.prototype.toString;function ba(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":ga.call(t)}var E=i({is(t){return t.kind==="AlterTableNode"},create(t){return i({kind:"AlterTableNode",table:t})},cloneWithTableProps(t,e){return i({...t,...e})},cloneWithColumnAlteration(t,e){return i({...t,columnAlterations:t.columnAlterations?[...t.columnAlterations,e]:[e]})}});var N=i({is(t){return t.kind==="IdentifierNode"},create(t){return i({kind:"IdentifierNode",name:t})}});var me=i({is(t){return t.kind==="CreateIndexNode"},create(t){return i({kind:"CreateIndexNode",name:N.create(t)})},cloneWith(t,e){return i({...t,...e})},cloneWithColumns(t,e){return i({...t,columns:[...t.columns||[],...e]})}});var ai=i({is(t){return t.kind==="CreateSchemaNode"},create(t,e){return i({kind:"CreateSchemaNode",schema:N.create(t),...e})},cloneWith(t,e){return i({...t,...e})}});var Cn=["preserve rows","delete rows","drop"],Y=i({is(t){return t.kind==="CreateTableNode"},create(t){return i({kind:"CreateTableNode",table:t,columns:i([])})},cloneWithColumn(t,e){return i({...t,columns:i([...t.columns,e])})},cloneWithConstraint(t,e){return i({...t,constraints:t.constraints?i([...t.constraints,e]):i([e])})},cloneWithFrontModifier(t,e){return i({...t,frontModifiers:t.frontModifiers?i([...t.frontModifiers,e]):i([e])})},cloneWithEndModifier(t,e){return i({...t,endModifiers:t.endModifiers?i([...t.endModifiers,e]):i([e])})},cloneWith(t,e){return i({...t,...e})}});var re=i({is(t){return t.kind==="SchemableIdentifierNode"},create(t){return i({kind:"SchemableIdentifierNode",identifier:N.create(t)})},createWithSchema(t,e){return i({kind:"SchemableIdentifierNode",schema:N.create(t),identifier:N.create(e)})}});var Ke=i({is(t){return t.kind==="DropIndexNode"},create(t,e){return i({kind:"DropIndexNode",name:re.create(t),...e})},cloneWith(t,e){return i({...t,...e})}});var mr=i({is(t){return t.kind==="DropSchemaNode"},create(t,e){return i({kind:"DropSchemaNode",schema:N.create(t),...e})},cloneWith(t,e){return i({...t,...e})}});var hr=i({is(t){return t.kind==="DropTableNode"},create(t,e){return i({kind:"DropTableNode",table:t,...e})},cloneWith(t,e){return i({...t,...e})}});var H=i({is(t){return t.kind==="AliasNode"},create(t,e){return i({kind:"AliasNode",node:t,alias:e})}});var ce=i({is(t){return t.kind==="TableNode"},create(t){return i({kind:"TableNode",table:re.create(t)})},createWithSchema(t,e){return i({kind:"TableNode",table:re.createWithSchema(t,e)})}});function D(t){return X(t)&&q(t.toOperationNode)}function vn(t){return X(t)&&"expressionType"in t&&D(t)}function Sn(t){return X(t)&&"expression"in t&&L(t.alias)&&D(t)}var Ie=i({is(t){return t.kind==="SelectModifierNode"},create(t,e){return i({kind:"SelectModifierNode",modifier:t,of:e})},createWithExpression(t){return i({kind:"SelectModifierNode",rawModifier:t})}});var ie=i({is(t){return t.kind==="AndNode"},create(t,e){return i({kind:"AndNode",left:t,right:e})}});var he=i({is(t){return t.kind==="OrNode"},create(t,e){return i({kind:"OrNode",left:t,right:e})}});var ui=i({is(t){return t.kind==="OnNode"},create(t){return i({kind:"OnNode",on:t})},cloneWithOperation(t,e,r){return i({...t,on:e==="And"?ie.create(t.on,r):he.create(t.on,r)})}});var Ge=i({is(t){return t.kind==="JoinNode"},create(t,e){return i({kind:"JoinNode",joinType:t,table:e,on:void 0})},createWithOn(t,e,r){return i({kind:"JoinNode",joinType:t,table:e,on:ui.create(r)})},cloneWithOn(t,e){return i({...t,on:t.on?ui.cloneWithOperation(t.on,"And",e):ui.create(e)})}});var Xe=i({is(t){return t.kind==="BinaryOperationNode"},create(t,e,r){return i({kind:"BinaryOperationNode",leftOperand:t,operator:e,rightOperand:r})}});var Oa=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","^@","&&","?","?&","?|","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->","regexp","is distinct from","is not distinct from"],Ea=["+","-","*","/","%","^","&","|","#","<<",">>"],An=["->","->>"],Ta=[...Oa,...Ea,"&&","||"],Ia=["exists","not exists"],Ca=["not","-",...Ia],Wn=[...Ta,...An,...Ca,"between","between symmetric"],ae=i({is(t){return t.kind==="OperatorNode"},create(t){return i({kind:"OperatorNode",operator:t})}});function yo(t){return L(t)&&An.includes(t)}var b=i({is(t){return t.kind==="ColumnNode"},create(t){return i({kind:"ColumnNode",column:N.create(t)})}});var Et=i({is(t){return t.kind==="SelectAllNode"},create(){return i({kind:"SelectAllNode"})}});var Tt=i({is(t){return t.kind==="ReferenceNode"},create(t,e){return i({kind:"ReferenceNode",table:e,column:t})},createSelectAll(t){return i({kind:"ReferenceNode",table:t,column:Et.create()})}});var di=class{#e;get dynamicReference(){return this.#e}get refType(){}constructor(e){this.#e=e}toOperationNode(){return wo(this.#e)}};function ci(t){return X(t)&&D(t)&&L(t.dynamicReference)}var pi=i({is(t){return t.kind==="OrderByItemNode"},create(t,e){return i({kind:"OrderByItemNode",orderBy:t,direction:e})}});var R=i({is(t){return t.kind==="RawNode"},create(t,e){return i({kind:"RawNode",sqlFragments:i(t),parameters:i(e)})},createWithSql(t){return R.create([t],[])},createWithChild(t){return R.create(["",""],[t])},createWithChildren(t){return R.create(new Array(t.length+1).fill(""),t)}});function go(t){return t==="asc"||t==="desc"}function _e(t){if(t.length===2)return[xo(t[0],t[1])];if(t.length===1){let[e]=t;return Array.isArray(e)?e.map(r=>xo(r)):[xo(e)]}throw new Error(`Invalid number of arguments at order by! expected 1-2, received ${t.length}`)}function xo(t,e){let r=va(t);if(pi.is(r)){if(e)throw new Error("Cannot specify direction twice!");return r}return pi.create(r,qn(e))}function va(t){if(Be(t))return oe(t);if(ci(t))return t.toOperationNode();let[e,r]=t.split(" ");if(r){if(!go(r))throw new Error(`Invalid order by direction: ${r}`);return pi.create(ue(e),qn(r))}return ue(t)}function qn(t){if(t)return t==="asc"||t==="desc"?R.createWithSql(t):t.toOperationNode()}var It=i({is(t){return t.kind==="JSONReferenceNode"},create(t,e){return i({kind:"JSONReferenceNode",reference:t,traversal:e})},cloneWithTraversal(t,e){return i({...t,traversal:e})}});var li=i({is(t){return t.kind==="JSONOperatorChainNode"},create(t){return i({kind:"JSONOperatorChainNode",operator:t,values:i([])})},cloneWithValue(t,e){return i({...t,values:i([...t.values,e])})}});var Ye=i({is(t){return t.kind==="JSONPathNode"},create(t){return i({kind:"JSONPathNode",inOperator:t,pathLegs:i([])})},cloneWithLeg(t,e){return i({...t,pathLegs:i([...t.pathLegs,e])})}});function wo(t){return L(t)?ue(t):t.toOperationNode()}function Me(t){return _(t)?t.map(e=>V(e)):[V(t)]}function V(t){return Be(t)?oe(t):wo(t)}function Dn(t,e){let r=ue(t);if(yo(e))return It.create(r,li.create(ae.create(e)));let o=e.slice(0,-1);if(yo(o))return It.create(r,Ye.create(ae.create(o)));throw new Error(`Invalid JSON operator: ${e}`)}function ue(t){let e=".";if(!t.includes(e))return Tt.create(b.create(t));let r=t.split(e).map(Oo);if(r.length===3)return Sa(r);if(r.length===2)return Aa(r);throw new Error(`invalid column reference ${t}`)}function Rn(t){let e=" as ";if(t.includes(e)){let[r,o]=t.split(e).map(Oo);return H.create(ue(r),N.create(o))}else return ue(t)}function bo(t){return b.create(t)}function Ct(t){let e=" ";if(t.includes(e)){let[r,o]=t.split(e).map(Oo);if(!go(o))throw new Error(`invalid order direction "${o}" next to "${r}"`);return _e([r,o])[0]}else return bo(t)}function Sa(t){let[e,r,o]=t;return Tt.create(b.create(o),ce.createWithSchema(e,r))}function Aa(t){let[e,r]=t;return Tt.create(b.create(r),ce.create(e))}function Oo(t){return t.trim()}var mi=i({is(t){return t.kind==="PrimitiveValueListNode"},create(t){return i({kind:"PrimitiveValueListNode",values:i([...t])})}});var vt=i({is(t){return t.kind==="ValueListNode"},create(t){return i({kind:"ValueListNode",values:i(t)})}});var $=i({is(t){return t.kind==="ValueNode"},create(t){return i({kind:"ValueNode",value:t})},createImmediate(t){return i({kind:"ValueNode",value:t,immediate:!0})}});function kn(t){return _(t)?Wa(t):v(t)}function v(t){return Be(t)?oe(t):$.create(t)}function hi(t){return je(t)||ut(t)||bt(t)}function fr(t){if(!hi(t))throw new Error(`unsafe immediate value ${JSON.stringify(t)}`);return $.createImmediate(t)}function Wa(t){return t.some(Be)?vt.create(t.map(e=>v(e))):mi.create(t)}var Ce=i({is(t){return t.kind==="ParensNode"},create(t){return i({kind:"ParensNode",node:t})}});function A(t){if(t.length===3)return fi(t[0],t[1],t[2]);if(t.length===1)return v(t[0]);throw new Error(`invalid arguments: ${JSON.stringify(t)}`)}function fi(t,e,r){return qa(e)&&Pn(r)?Xe.create(V(t),Eo(e),$.createImmediate(r)):Xe.create(V(t),Eo(e),kn(r))}function U(t,e,r){return Xe.create(V(t),Eo(e),V(r))}function To(t,e){return St(Object.entries(t).filter(([,r])=>!se(r)).map(([r,o])=>fi(r,Pn(o)?"is":"=",o)),e)}function St(t,e,r=!0){let o=e==="and"?ie.create:he.create;if(t.length===0)return Xe.create($.createImmediate(1),ae.create("="),$.createImmediate(e==="and"?1:0));let n=Ln(t[0]);for(let s=1;s<t.length;++s)n=o(n,Ln(t[s]));return t.length>1&&r?Ce.create(n):n}function qa(t){return t==="is"||t==="is not"}function Pn(t){return bt(t)||ut(t)}function Eo(t){if(L(t)&&Wn.includes(t))return ae.create(t);if(D(t))return t.toOperationNode();throw new Error(`invalid operator ${JSON.stringify(t)}`)}function Ln(t){return D(t)?t.toOperationNode():t}var Fe=i({is(t){return t.kind==="OrderByNode"},create(t){return i({kind:"OrderByNode",items:i([...t])})},cloneWithItems(t,e){return i({...t,items:i([...t.items,...e])})}});var Io=i({is(t){return t.kind==="PartitionByNode"},create(t){return i({kind:"PartitionByNode",items:i(t)})},cloneWithItems(t,e){return i({...t,items:i([...t.items,...e])})}});var Nr=i({is(t){return t.kind==="OverNode"},create(){return i({kind:"OverNode"})},cloneWithOrderByItems(t,e){return i({...t,orderBy:t.orderBy?Fe.cloneWithItems(t.orderBy,e):Fe.create(e)})},cloneWithPartitionByItems(t,e){return i({...t,partitionBy:t.partitionBy?Io.cloneWithItems(t.partitionBy,e):Io.create(e)})}});var dt=i({is(t){return t.kind==="FromNode"},create(t){return i({kind:"FromNode",froms:i(t)})},cloneWithFroms(t,e){return i({...t,froms:i([...t.froms,...e])})}});var Co=i({is(t){return t.kind==="GroupByNode"},create(t){return i({kind:"GroupByNode",items:i(t)})},cloneWithItems(t,e){return i({...t,items:i([...t.items,...e])})}});var vo=i({is(t){return t.kind==="HavingNode"},create(t){return i({kind:"HavingNode",having:t})},cloneWithOperation(t,e,r){return i({...t,having:e==="And"?ie.create(t.having,r):he.create(t.having,r)})}});var w=i({is(t){return t.kind==="SelectQueryNode"},create(t){return i({kind:"SelectQueryNode",...t&&{with:t}})},createFrom(t,e){return i({kind:"SelectQueryNode",from:dt.create(t),...e&&{with:e}})},cloneWithSelections(t,e){return i({...t,selections:t.selections?i([...t.selections,...e]):i(e)})},cloneWithDistinctOn(t,e){return i({...t,distinctOn:t.distinctOn?i([...t.distinctOn,...e]):i(e)})},cloneWithFrontModifier(t,e){return i({...t,frontModifiers:t.frontModifiers?i([...t.frontModifiers,e]):i([e])})},cloneWithEndModifier(t,e){return i({...t,endModifiers:t.endModifiers?i([...t.endModifiers,e]):i([e])})},cloneWithOrderByItems(t,e){return i({...t,orderBy:t.orderBy?Fe.cloneWithItems(t.orderBy,e):Fe.create(e)})},cloneWithGroupByItems(t,e){return i({...t,groupBy:t.groupBy?Co.cloneWithItems(t.groupBy,e):Co.create(e)})},cloneWithLimit(t,e){return i({...t,limit:e})},cloneWithOffset(t,e){return i({...t,offset:e})},cloneWithFetch(t,e){return i({...t,fetch:e})},cloneWithHaving(t,e){return i({...t,having:t.having?vo.cloneWithOperation(t.having,"And",e):vo.create(e)})},cloneWithSetOperations(t,e){return i({...t,setOperations:t.setOperations?i([...t.setOperations,...e]):i([...e])})},cloneWithoutSelections(t){return i({...t,selections:[]})},cloneWithoutLimit(t){return i({...t,limit:void 0})},cloneWithoutOffset(t){return i({...t,offset:void 0})},cloneWithoutOrderBy(t){return i({...t,orderBy:void 0})},cloneWithoutGroupBy(t){return i({...t,groupBy:void 0})}});function p(t,e){Object.defineProperties(t.prototype,{then:{enumerable:!1,value:()=>{throw new Error(e)}}})}var yr=class t{#e;constructor(e){this.#e=i(e)}on(...e){return new t({...this.#e,joinNode:Ge.cloneWithOn(this.#e.joinNode,A(e))})}onRef(e,r,o){return new t({...this.#e,joinNode:Ge.cloneWithOn(this.#e.joinNode,U(e,r,o))})}onTrue(){return new t({...this.#e,joinNode:Ge.cloneWithOn(this.#e.joinNode,R.createWithSql("true"))})}$call(e){return e(this)}toOperationNode(){return this.#e.joinNode}};p(yr,"don't await JoinBuilder instances. They are never executed directly and are always just a part of a query.");var Bn=i({is(t){return t.kind==="PartitionByItemNode"},create(t){return i({kind:"PartitionByItemNode",partitionBy:t})}});function Mn(t){return Me(t).map(Bn.create)}var wr=class t{#e;constructor(e){this.#e=i(e)}orderBy(e,r){return new t({overNode:Nr.cloneWithOrderByItems(this.#e.overNode,_e([e,r]))})}partitionBy(e){return new t({overNode:Nr.cloneWithPartitionByItems(this.#e.overNode,Mn(e))})}$call(e){return e(this)}toOperationNode(){return this.#e.overNode}};p(wr,"don't await OverBuilder instances. They are never executed directly and are always just a part of a query.");var At=i({is(t){return t.kind==="SelectionNode"},create(t){return i({kind:"SelectionNode",selection:t})},createSelectAll(){return i({kind:"SelectionNode",selection:Et.create()})},createSelectAllFromTable(t){return i({kind:"SelectionNode",selection:Tt.createSelectAll(t)})}});function J(t){return q(t)?J(t(fe())):_(t)?t.map(e=>Fn(e)):[Fn(t)]}function Fn(t){return L(t)?At.create(Rn(t)):ci(t)?At.create(t.toOperationNode()):At.create(Ni(t))}function Z(t){return t?Array.isArray(t)?t.map(Un):[Un(t)]:[At.createSelectAll()]}function Un(t){if(L(t))return At.createSelectAllFromTable(I(t));throw new Error(`invalid value selectAll expression: ${JSON.stringify(t)}`)}var zn=i({is(t){return t.kind==="ValuesNode"},create(t){return i({kind:"ValuesNode",values:i(t)})}});var Qn=i({is(t){return t.kind==="DefaultInsertValueNode"},create(){return i({kind:"DefaultInsertValueNode"})}});function yi(t){let e=q(t)?t(fe()):t,r=_(e)?e:i([e]);return Da(r)}function Da(t){let e=Ra(t);return[i([...e.keys()].map(b.create)),zn.create(t.map(r=>ka(r,e)))]}function Ra(t){let e=new Map;for(let r of t){let o=Object.keys(r);for(let n of o)!e.has(n)&&r[n]!==void 0&&e.set(n,e.size)}return e}function ka(t,e){let r=Object.keys(t),o=Array.from({length:e.size}),n=!1;for(let a of r){let u=e.get(a);if(se(u))continue;let d=t[a];(se(d)||Be(d))&&(n=!0),o[u]=d}if(r.length<e.size||n){let a=Qn.create();return vt.create(o.map(u=>se(u)?a:v(u)))}return mi.create(o)}var z=i({is(t){return t.kind==="InsertQueryNode"},create(t,e,r){return i({kind:"InsertQueryNode",into:t,...e&&{with:e},replace:r})},createWithoutInto(){return i({kind:"InsertQueryNode"})},cloneWith(t,e){return i({...t,...e})}});var ve=i({is(t){return t.kind==="UpdateQueryNode"},create(t,e){return i({kind:"UpdateQueryNode",table:t,...e&&{with:e}})},createWithoutTable(){return i({kind:"UpdateQueryNode"})},cloneWithFromItems(t,e){return i({...t,from:t.from?dt.cloneWithFroms(t.from,e):dt.create(e)})},cloneWithUpdates(t,e){return i({...t,updates:t.updates?i([...t.updates,...e]):e})},cloneWithLimit(t,e){return i({...t,limit:e})}});var So=i({is(t){return t.kind==="UsingNode"},create(t){return i({kind:"UsingNode",tables:i(t)})},cloneWithTables(t,e){return i({...t,tables:i([...t.tables,...e])})}});var Se=i({is(t){return t.kind==="DeleteQueryNode"},create(t,e){return i({kind:"DeleteQueryNode",from:dt.create(t),...e&&{with:e}})},cloneWithOrderByItems(t,e){return i({...t,orderBy:t.orderBy?Fe.cloneWithItems(t.orderBy,e):Fe.create(e)})},cloneWithoutOrderBy(t){return i({...t,orderBy:void 0})},cloneWithLimit(t,e){return i({...t,limit:e})},cloneWithoutLimit(t){return i({...t,limit:void 0})},cloneWithUsing(t,e){return i({...t,using:t.using!==void 0?So.cloneWithTables(t.using,e):So.create(e)})}});var j=i({is(t){return t.kind==="WhereNode"},create(t){return i({kind:"WhereNode",where:t})},cloneWithOperation(t,e,r){return i({...t,where:e==="And"?ie.create(t.where,r):he.create(t.where,r)})}});var Ao=i({is(t){return t.kind==="ReturningNode"},create(t){return i({kind:"ReturningNode",selections:i(t)})},cloneWithSelections(t,e){return i({...t,selections:t.selections?i([...t.selections,...e]):i(e)})}});var Vn=i({is(t){return t.kind==="ExplainNode"},create(t,e){return i({kind:"ExplainNode",format:t,options:e})}});var Ue=i({is(t){return t.kind==="WhenNode"},create(t){return i({kind:"WhenNode",condition:t})},cloneWithResult(t,e){return i({...t,result:e})}});var Q=i({is(t){return t.kind==="MergeQueryNode"},create(t,e){return i({kind:"MergeQueryNode",into:t,...e&&{with:e}})},cloneWithUsing(t,e){return i({...t,using:e})},cloneWithWhen(t,e){return i({...t,whens:t.whens?i([...t.whens,e]):i([e])})},cloneWithThen(t,e){return i({...t,whens:t.whens?i([...t.whens.slice(0,-1),Ue.cloneWithResult(t.whens[t.whens.length-1],e)]):void 0})}});var Wo=i({is(t){return t.kind==="OutputNode"},create(t){return i({kind:"OutputNode",selections:i(t)})},cloneWithSelections(t,e){return i({...t,selections:t.selections?i([...t.selections,...e]):i(e)})}});var l=i({is(t){return w.is(t)||z.is(t)||ve.is(t)||Se.is(t)||Q.is(t)},cloneWithWhere(t,e){return i({...t,where:t.where?j.cloneWithOperation(t.where,"And",e):j.create(e)})},cloneWithJoin(t,e){return i({...t,joins:t.joins?i([...t.joins,e]):i([e])})},cloneWithReturning(t,e){return i({...t,returning:t.returning?Ao.cloneWithSelections(t.returning,e):Ao.create(e)})},cloneWithoutReturning(t){return i({...t,returning:void 0})},cloneWithoutWhere(t){return i({...t,where:void 0})},cloneWithExplain(t,e,r){return i({...t,explain:Vn.create(e,r?.toOperationNode())})},cloneWithTop(t,e){return i({...t,top:e})},cloneWithOutput(t,e){return i({...t,output:t.output?Wo.cloneWithSelections(t.output,e):Wo.create(e)})}});var qo=i({is(t){return t.kind==="ColumnUpdateNode"},create(t,e){return i({kind:"ColumnUpdateNode",column:t,value:e})}});function $n(...t){return t.length===2?[qo.create(V(t[0]),v(t[1]))]:xr(t[0])}function xr(t){let e=q(t)?t(fe()):t;return Object.entries(e).filter(([r,o])=>o!==void 0).map(([r,o])=>qo.create(b.create(r),v(o)))}var Jn=i({is(t){return t.kind==="OnDuplicateKeyNode"},create(t){return i({kind:"OnDuplicateKeyNode",updates:t})}});var wi=class{insertId;numInsertedOrUpdatedRows;constructor(e,r){this.insertId=e,this.numInsertedOrUpdatedRows=r}};var pe=class extends Error{node;constructor(e){super("no result"),this.node=e}};function Ae(t){return Object.prototype.hasOwnProperty.call(t,"prototype")}var te=i({is(t){return t.kind==="OnConflictNode"},create(){return i({kind:"OnConflictNode"})},cloneWith(t,e){return i({...t,...e})},cloneWithIndexWhere(t,e){return i({...t,indexWhere:t.indexWhere?j.cloneWithOperation(t.indexWhere,"And",e):j.create(e)})},cloneWithIndexOrWhere(t,e){return i({...t,indexWhere:t.indexWhere?j.cloneWithOperation(t.indexWhere,"Or",e):j.create(e)})},cloneWithUpdateWhere(t,e){return i({...t,updateWhere:t.updateWhere?j.cloneWithOperation(t.updateWhere,"And",e):j.create(e)})},cloneWithUpdateOrWhere(t,e){return i({...t,updateWhere:t.updateWhere?j.cloneWithOperation(t.updateWhere,"Or",e):j.create(e)})},cloneWithoutIndexWhere(t){return i({...t,indexWhere:void 0})},cloneWithoutUpdateWhere(t){return i({...t,updateWhere:void 0})}});var gr=class t{#e;constructor(e){this.#e=i(e)}column(e){let r=b.create(e);return new t({...this.#e,onConflictNode:te.cloneWith(this.#e.onConflictNode,{columns:this.#e.onConflictNode.columns?i([...this.#e.onConflictNode.columns,r]):i([r])})})}columns(e){let r=e.map(b.create);return new t({...this.#e,onConflictNode:te.cloneWith(this.#e.onConflictNode,{columns:this.#e.onConflictNode.columns?i([...this.#e.onConflictNode.columns,...r]):i(r)})})}constraint(e){return new t({...this.#e,onConflictNode:te.cloneWith(this.#e.onConflictNode,{constraint:N.create(e)})})}expression(e){return new t({...this.#e,onConflictNode:te.cloneWith(this.#e.onConflictNode,{indexExpression:e.toOperationNode()})})}where(...e){return new t({...this.#e,onConflictNode:te.cloneWithIndexWhere(this.#e.onConflictNode,A(e))})}whereRef(e,r,o){return new t({...this.#e,onConflictNode:te.cloneWithIndexWhere(this.#e.onConflictNode,U(e,r,o))})}clearWhere(){return new t({...this.#e,onConflictNode:te.cloneWithoutIndexWhere(this.#e.onConflictNode)})}doNothing(){return new xi({...this.#e,onConflictNode:te.cloneWith(this.#e.onConflictNode,{doNothing:!0})})}doUpdateSet(e){return new gi({...this.#e,onConflictNode:te.cloneWith(this.#e.onConflictNode,{updates:xr(e)})})}$call(e){return e(this)}};p(gr,"don't await OnConflictBuilder instances.");var xi=class{#e;constructor(e){this.#e=i(e)}toOperationNode(){return this.#e.onConflictNode}};p(xi,"don't await OnConflictDoNothingBuilder instances.");var gi=class t{#e;constructor(e){this.#e=i(e)}where(...e){return new t({...this.#e,onConflictNode:te.cloneWithUpdateWhere(this.#e.onConflictNode,A(e))})}whereRef(e,r,o){return new t({...this.#e,onConflictNode:te.cloneWithUpdateWhere(this.#e.onConflictNode,U(e,r,o))})}clearWhere(){return new t({...this.#e,onConflictNode:te.cloneWithoutUpdateWhere(this.#e.onConflictNode)})}$call(e){return e(this)}toOperationNode(){return this.#e.onConflictNode}};p(gi,"don't await OnConflictUpdateBuilder instances.");var jn=i({is(t){return t.kind==="TopNode"},create(t,e){return i({kind:"TopNode",expression:t,modifiers:e})}});function Ne(t,e){if(!je(t)&&!Ot(t))throw new Error(`Invalid top expression: ${t}`);if(!se(e)&&!La(e))throw new Error(`Invalid top modifiers: ${e}`);return jn.create(t,e)}function La(t){return t==="percent"||t==="with ties"||t==="percent with ties"}var Wt=class t{#e;constructor(e){this.#e=i(e)}values(e){let[r,o]=yi(e);return new t({...this.#e,queryNode:z.cloneWith(this.#e.queryNode,{columns:r,values:o})})}columns(e){return new t({...this.#e,queryNode:z.cloneWith(this.#e.queryNode,{columns:i(e.map(b.create))})})}expression(e){return new t({...this.#e,queryNode:z.cloneWith(this.#e.queryNode,{values:oe(e)})})}defaultValues(){return new t({...this.#e,queryNode:z.cloneWith(this.#e.queryNode,{defaultValues:!0})})}ignore(){return new t({...this.#e,queryNode:z.cloneWith(this.#e.queryNode,{ignore:!0})})}top(e,r){return new t({...this.#e,queryNode:l.cloneWithTop(this.#e.queryNode,Ne(e,r))})}onConflict(e){return new t({...this.#e,queryNode:z.cloneWith(this.#e.queryNode,{onConflict:e(new gr({onConflictNode:te.create()})).toOperationNode()})})}onDuplicateKeyUpdate(e){return new t({...this.#e,queryNode:z.cloneWith(this.#e.queryNode,{onDuplicateKey:Jn.create(xr(e))})})}returning(e){return new t({...this.#e,queryNode:l.cloneWithReturning(this.#e.queryNode,J(e))})}returningAll(){return new t({...this.#e,queryNode:l.cloneWithReturning(this.#e.queryNode,Z())})}output(e){return new t({...this.#e,queryNode:l.cloneWithOutput(this.#e.queryNode,J(e))})}outputAll(e){return new t({...this.#e,queryNode:l.cloneWithOutput(this.#e.queryNode,Z(e))})}clearReturning(){return new t({...this.#e,queryNode:l.cloneWithoutReturning(this.#e.queryNode)})}$call(e){return e(this)}$if(e,r){return e?r(this):new t({...this.#e})}$castTo(){return new t(this.#e)}$narrowType(){return new t(this.#e)}$assertType(){return new t(this.#e)}withPlugin(e){return new t({...this.#e,executor:this.#e.executor.withPlugin(e)})}toOperationNode(){return this.#e.executor.transformQuery(this.#e.queryNode,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){let e=this.compile(),r=await this.#e.executor.executeQuery(e,this.#e.queryId),{adapter:o}=this.#e.executor,n=e.query;return n.returning&&o.supportsReturning||n.output&&o.supportsOutput?r.rows:[new wi(r.insertId,r.numAffectedRows??r.numUpdatedOrDeletedRows)]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=pe){let r=await this.executeTakeFirst();if(r===void 0)throw Ae(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){let r=this.compile(),o=this.#e.executor.stream(r,e,this.#e.queryId);for await(let n of o)yield*n.rows}async explain(e,r){return await new t({...this.#e,queryNode:l.cloneWithExplain(this.#e.queryNode,e,r)}).execute()}};p(Wt,"don't await InsertQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");var bi=class{numDeletedRows;constructor(e){this.numDeletedRows=e}};var qt=i({is(t){return t.kind==="LimitNode"},create(t){return i({kind:"LimitNode",limit:t})}});var br=class t{#e;constructor(e){this.#e=i(e)}where(...e){return new t({...this.#e,queryNode:l.cloneWithWhere(this.#e.queryNode,A(e))})}whereRef(e,r,o){return new t({...this.#e,queryNode:l.cloneWithWhere(this.#e.queryNode,U(e,r,o))})}clearWhere(){return new t({...this.#e,queryNode:l.cloneWithoutWhere(this.#e.queryNode)})}top(e,r){return new t({...this.#e,queryNode:l.cloneWithTop(this.#e.queryNode,Ne(e,r))})}using(e){return new t({...this.#e,queryNode:Se.cloneWithUsing(this.#e.queryNode,We(e))})}innerJoin(...e){return new t({...this.#e,queryNode:l.cloneWithJoin(this.#e.queryNode,M("InnerJoin",e))})}leftJoin(...e){return new t({...this.#e,queryNode:l.cloneWithJoin(this.#e.queryNode,M("LeftJoin",e))})}rightJoin(...e){return new t({...this.#e,queryNode:l.cloneWithJoin(this.#e.queryNode,M("RightJoin",e))})}fullJoin(...e){return new t({...this.#e,queryNode:l.cloneWithJoin(this.#e.queryNode,M("FullJoin",e))})}returning(e){return new t({...this.#e,queryNode:l.cloneWithReturning(this.#e.queryNode,J(e))})}returningAll(e){return new t({...this.#e,queryNode:l.cloneWithReturning(this.#e.queryNode,Z(e))})}output(e){return new t({...this.#e,queryNode:l.cloneWithOutput(this.#e.queryNode,J(e))})}outputAll(e){return new t({...this.#e,queryNode:l.cloneWithOutput(this.#e.queryNode,Z(e))})}clearReturning(){return new t({...this.#e,queryNode:l.cloneWithoutReturning(this.#e.queryNode)})}clearLimit(){return new t({...this.#e,queryNode:Se.cloneWithoutLimit(this.#e.queryNode)})}clearOrderBy(){return new t({...this.#e,queryNode:Se.cloneWithoutOrderBy(this.#e.queryNode)})}orderBy(e,r){return new t({...this.#e,queryNode:Se.cloneWithOrderByItems(this.#e.queryNode,_e([e,r]))})}limit(e){return new t({...this.#e,queryNode:Se.cloneWithLimit(this.#e.queryNode,qt.create(v(e)))})}$call(e){return e(this)}$if(e,r){return e?r(this):new t({...this.#e})}$castTo(){return new t(this.#e)}$narrowType(){return new t(this.#e)}$assertType(){return new t(this.#e)}withPlugin(e){return new t({...this.#e,executor:this.#e.executor.withPlugin(e)})}toOperationNode(){return this.#e.executor.transformQuery(this.#e.queryNode,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){let e=this.compile(),r=await this.#e.executor.executeQuery(e,this.#e.queryId),{adapter:o}=this.#e.executor,n=e.query;return n.returning&&o.supportsReturning||n.output&&o.supportsOutput?r.rows:[new bi(r.numAffectedRows??r.numUpdatedOrDeletedRows??BigInt(0))]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=pe){let r=await this.executeTakeFirst();if(r===void 0)throw Ae(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){let r=this.compile(),o=this.#e.executor.stream(r,e,this.#e.queryId);for await(let n of o)yield*n.rows}async explain(e,r){return await new t({...this.#e,queryNode:l.cloneWithExplain(this.#e.queryNode,e,r)}).execute()}};p(br,"don't await DeleteQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");var Oi=class{numUpdatedRows;numChangedRows;constructor(e,r){this.numUpdatedRows=e,this.numChangedRows=r}};var ct=class t{#e;constructor(e){this.#e=i(e)}where(...e){return new t({...this.#e,queryNode:l.cloneWithWhere(this.#e.queryNode,A(e))})}whereRef(e,r,o){return new t({...this.#e,queryNode:l.cloneWithWhere(this.#e.queryNode,U(e,r,o))})}clearWhere(){return new t({...this.#e,queryNode:l.cloneWithoutWhere(this.#e.queryNode)})}top(e,r){return new t({...this.#e,queryNode:l.cloneWithTop(this.#e.queryNode,Ne(e,r))})}from(e){return new t({...this.#e,queryNode:ve.cloneWithFromItems(this.#e.queryNode,We(e))})}innerJoin(...e){return new t({...this.#e,queryNode:l.cloneWithJoin(this.#e.queryNode,M("InnerJoin",e))})}leftJoin(...e){return new t({...this.#e,queryNode:l.cloneWithJoin(this.#e.queryNode,M("LeftJoin",e))})}rightJoin(...e){return new t({...this.#e,queryNode:l.cloneWithJoin(this.#e.queryNode,M("RightJoin",e))})}fullJoin(...e){return new t({...this.#e,queryNode:l.cloneWithJoin(this.#e.queryNode,M("FullJoin",e))})}limit(e){return new t({...this.#e,queryNode:ve.cloneWithLimit(this.#e.queryNode,qt.create(v(e)))})}set(...e){return new t({...this.#e,queryNode:ve.cloneWithUpdates(this.#e.queryNode,$n(...e))})}returning(e){return new t({...this.#e,queryNode:l.cloneWithReturning(this.#e.queryNode,J(e))})}returningAll(e){return new t({...this.#e,queryNode:l.cloneWithReturning(this.#e.queryNode,Z(e))})}output(e){return new t({...this.#e,queryNode:l.cloneWithOutput(this.#e.queryNode,J(e))})}outputAll(e){return new t({...this.#e,queryNode:l.cloneWithOutput(this.#e.queryNode,Z(e))})}clearReturning(){return new t({...this.#e,queryNode:l.cloneWithoutReturning(this.#e.queryNode)})}$call(e){return e(this)}$if(e,r){return e?r(this):new t({...this.#e})}$castTo(){return new t(this.#e)}$narrowType(){return new t(this.#e)}$assertType(){return new t(this.#e)}withPlugin(e){return new t({...this.#e,executor:this.#e.executor.withPlugin(e)})}toOperationNode(){return this.#e.executor.transformQuery(this.#e.queryNode,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){let e=this.compile(),r=await this.#e.executor.executeQuery(e,this.#e.queryId),{adapter:o}=this.#e.executor,n=e.query;return n.returning&&o.supportsReturning||n.output&&o.supportsOutput?r.rows:[new Oi(r.numAffectedRows??r.numUpdatedOrDeletedRows??BigInt(0),r.numChangedRows)]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=pe){let r=await this.executeTakeFirst();if(r===void 0)throw Ae(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){let r=this.compile(),o=this.#e.executor.stream(r,e,this.#e.queryId);for await(let n of o)yield*n.rows}async explain(e,r){return await new t({...this.#e,queryNode:l.cloneWithExplain(this.#e.queryNode,e,r)}).execute()}};p(ct,"don't await UpdateQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");var Do=i({is(t){return t.kind==="CommonTableExpressionNameNode"},create(t,e){return i({kind:"CommonTableExpressionNameNode",table:ce.create(t),columns:e?i(e.map(b.create)):void 0})}});var Dt=i({is(t){return t.kind==="CommonTableExpressionNode"},create(t,e){return i({kind:"CommonTableExpressionNode",name:t,expression:e})},cloneWith(t,e){return i({...t,...e})}});var Or=class t{#e;constructor(e){this.#e=i(e)}materialized(){return new t({...this.#e,node:Dt.cloneWith(this.#e.node,{materialized:!0})})}notMaterialized(){return new t({...this.#e,node:Dt.cloneWith(this.#e.node,{materialized:!1})})}toOperationNode(){return this.#e.node}};p(Or,"don't await CTEBuilder instances. They are never executed directly and are always just a part of a query.");function Ro(t,e){let r=e(Gn()).toOperationNode();return q(t)?t(Pa(r)).toOperationNode():Dt.create(Kn(t),r)}function Pa(t){return e=>new Or({node:Dt.create(Kn(e),t)})}function Kn(t){if(t.includes("(")){let e=t.split(/[\(\)]/),r=e[0],o=e[1].split(",").map(n=>n.trim());return Do.create(r,o)}else return Do.create(t)}var Er=i({is(t){return t.kind==="WithNode"},create(t,e){return i({kind:"WithNode",expressions:i([t]),...e})},cloneWithExpression(t,e){return i({...t,expressions:i([...t.expressions,e])})}});var Xn=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function _n(t){let e="";for(let r=0;r<t;++r)e+=Ba();return e}function Ba(){return Xn[~~(Math.random()*Xn.length)]}function T(){return new ko}var ko=class{#e;get queryId(){return this.#e===void 0&&(this.#e=_n(8)),this.#e}};var He=class{nodeStack=[];#e=i({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this),JSONReferenceNode:this.transformJSONReference.bind(this),JSONPathNode:this.transformJSONPath.bind(this),JSONPathLegNode:this.transformJSONPathLeg.bind(this),JSONOperatorChainNode:this.transformJSONOperatorChain.bind(this),TupleNode:this.transformTuple.bind(this),MergeQueryNode:this.transformMergeQuery.bind(this),MatchedNode:this.transformMatched.bind(this),AddIndexNode:this.transformAddIndex.bind(this),CastNode:this.transformCast.bind(this),FetchNode:this.transformFetch.bind(this),TopNode:this.transformTop.bind(this),OutputNode:this.transformOutput.bind(this)});transformNode(e){if(!e)return e;this.nodeStack.push(e);let r=this.transformNodeImpl(e);return this.nodeStack.pop(),i(r)}transformNodeImpl(e){return this.#e[e.kind](e)}transformNodeList(e){return e&&i(e.map(r=>this.transformNode(r)))}transformSelectQuery(e){return{kind:"SelectQueryNode",from:this.transformNode(e.from),selections:this.transformNodeList(e.selections),distinctOn:this.transformNodeList(e.distinctOn),joins:this.transformNodeList(e.joins),groupBy:this.transformNode(e.groupBy),orderBy:this.transformNode(e.orderBy),where:this.transformNode(e.where),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),limit:this.transformNode(e.limit),offset:this.transformNode(e.offset),with:this.transformNode(e.with),having:this.transformNode(e.having),explain:this.transformNode(e.explain),setOperations:this.transformNodeList(e.setOperations),fetch:this.transformNode(e.fetch),top:this.transformNode(e.top)}}transformSelection(e){return{kind:"SelectionNode",selection:this.transformNode(e.selection)}}transformColumn(e){return{kind:"ColumnNode",column:this.transformNode(e.column)}}transformAlias(e){return{kind:"AliasNode",node:this.transformNode(e.node),alias:this.transformNode(e.alias)}}transformTable(e){return{kind:"TableNode",table:this.transformNode(e.table)}}transformFrom(e){return{kind:"FromNode",froms:this.transformNodeList(e.froms)}}transformReference(e){return{kind:"ReferenceNode",column:this.transformNode(e.column),table:this.transformNode(e.table)}}transformAnd(e){return{kind:"AndNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformOr(e){return{kind:"OrNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformValueList(e){return{kind:"ValueListNode",values:this.transformNodeList(e.values)}}transformParens(e){return{kind:"ParensNode",node:this.transformNode(e.node)}}transformJoin(e){return{kind:"JoinNode",joinType:e.joinType,table:this.transformNode(e.table),on:this.transformNode(e.on)}}transformRaw(e){return{kind:"RawNode",sqlFragments:i([...e.sqlFragments]),parameters:this.transformNodeList(e.parameters)}}transformWhere(e){return{kind:"WhereNode",where:this.transformNode(e.where)}}transformInsertQuery(e){return{kind:"InsertQueryNode",into:this.transformNode(e.into),columns:this.transformNodeList(e.columns),values:this.transformNode(e.values),returning:this.transformNode(e.returning),onConflict:this.transformNode(e.onConflict),onDuplicateKey:this.transformNode(e.onDuplicateKey),with:this.transformNode(e.with),ignore:e.ignore,replace:e.replace,explain:this.transformNode(e.explain),defaultValues:e.defaultValues,top:this.transformNode(e.top),output:this.transformNode(e.output)}}transformValues(e){return{kind:"ValuesNode",values:this.transformNodeList(e.values)}}transformDeleteQuery(e){return{kind:"DeleteQueryNode",from:this.transformNode(e.from),using:this.transformNode(e.using),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),returning:this.transformNode(e.returning),with:this.transformNode(e.with),orderBy:this.transformNode(e.orderBy),limit:this.transformNode(e.limit),explain:this.transformNode(e.explain),top:this.transformNode(e.top),output:this.transformNode(e.output)}}transformReturning(e){return{kind:"ReturningNode",selections:this.transformNodeList(e.selections)}}transformCreateTable(e){return{kind:"CreateTableNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),constraints:this.transformNodeList(e.constraints),temporary:e.temporary,ifNotExists:e.ifNotExists,onCommit:e.onCommit,frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),selectQuery:this.transformNode(e.selectQuery)}}transformColumnDefinition(e){return{kind:"ColumnDefinitionNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),references:this.transformNode(e.references),primaryKey:e.primaryKey,autoIncrement:e.autoIncrement,unique:e.unique,notNull:e.notNull,unsigned:e.unsigned,defaultTo:this.transformNode(e.defaultTo),check:this.transformNode(e.check),generated:this.transformNode(e.generated),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),nullsNotDistinct:e.nullsNotDistinct,identity:e.identity,ifNotExists:e.ifNotExists}}transformAddColumn(e){return{kind:"AddColumnNode",column:this.transformNode(e.column)}}transformDropTable(e){return{kind:"DropTableNode",table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformOrderBy(e){return{kind:"OrderByNode",items:this.transformNodeList(e.items)}}transformOrderByItem(e){return{kind:"OrderByItemNode",orderBy:this.transformNode(e.orderBy),direction:this.transformNode(e.direction)}}transformGroupBy(e){return{kind:"GroupByNode",items:this.transformNodeList(e.items)}}transformGroupByItem(e){return{kind:"GroupByItemNode",groupBy:this.transformNode(e.groupBy)}}transformUpdateQuery(e){return{kind:"UpdateQueryNode",table:this.transformNode(e.table),from:this.transformNode(e.from),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),updates:this.transformNodeList(e.updates),returning:this.transformNode(e.returning),with:this.transformNode(e.with),explain:this.transformNode(e.explain),limit:this.transformNode(e.limit),top:this.transformNode(e.top),output:this.transformNode(e.output)}}transformColumnUpdate(e){return{kind:"ColumnUpdateNode",column:this.transformNode(e.column),value:this.transformNode(e.value)}}transformLimit(e){return{kind:"LimitNode",limit:this.transformNode(e.limit)}}transformOffset(e){return{kind:"OffsetNode",offset:this.transformNode(e.offset)}}transformOnConflict(e){return{kind:"OnConflictNode",columns:this.transformNodeList(e.columns),constraint:this.transformNode(e.constraint),indexExpression:this.transformNode(e.indexExpression),indexWhere:this.transformNode(e.indexWhere),updates:this.transformNodeList(e.updates),updateWhere:this.transformNode(e.updateWhere),doNothing:e.doNothing}}transformOnDuplicateKey(e){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(e.updates)}}transformCreateIndex(e){return{kind:"CreateIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists,where:this.transformNode(e.where),nullsNotDistinct:e.nullsNotDistinct}}transformList(e){return{kind:"ListNode",items:this.transformNodeList(e.items)}}transformDropIndex(e){return{kind:"DropIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformPrimaryKeyConstraint(e){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name)}}transformUniqueConstraint(e){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name),nullsNotDistinct:e.nullsNotDistinct}}transformForeignKeyConstraint(e){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(e.columns),references:this.transformNode(e.references),name:this.transformNode(e.name),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformSetOperation(e){return{kind:"SetOperationNode",operator:e.operator,expression:this.transformNode(e.expression),all:e.all}}transformReferences(e){return{kind:"ReferencesNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformCheckConstraint(e){return{kind:"CheckConstraintNode",expression:this.transformNode(e.expression),name:this.transformNode(e.name)}}transformWith(e){return{kind:"WithNode",expressions:this.transformNodeList(e.expressions),recursive:e.recursive}}transformCommonTableExpression(e){return{kind:"CommonTableExpressionNode",name:this.transformNode(e.name),materialized:e.materialized,expression:this.transformNode(e.expression)}}transformCommonTableExpressionName(e){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns)}}transformHaving(e){return{kind:"HavingNode",having:this.transformNode(e.having)}}transformCreateSchema(e){return{kind:"CreateSchemaNode",schema:this.transformNode(e.schema),ifNotExists:e.ifNotExists}}transformDropSchema(e){return{kind:"DropSchemaNode",schema:this.transformNode(e.schema),ifExists:e.ifExists,cascade:e.cascade}}transformAlterTable(e){return{kind:"AlterTableNode",table:this.transformNode(e.table),renameTo:this.transformNode(e.renameTo),setSchema:this.transformNode(e.setSchema),columnAlterations:this.transformNodeList(e.columnAlterations),addConstraint:this.transformNode(e.addConstraint),dropConstraint:this.transformNode(e.dropConstraint),addIndex:this.transformNode(e.addIndex),dropIndex:this.transformNode(e.dropIndex)}}transformDropColumn(e){return{kind:"DropColumnNode",column:this.transformNode(e.column)}}transformRenameColumn(e){return{kind:"RenameColumnNode",column:this.transformNode(e.column),renameTo:this.transformNode(e.renameTo)}}transformAlterColumn(e){return{kind:"AlterColumnNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),dataTypeExpression:this.transformNode(e.dataTypeExpression),setDefault:this.transformNode(e.setDefault),dropDefault:e.dropDefault,setNotNull:e.setNotNull,dropNotNull:e.dropNotNull}}transformModifyColumn(e){return{kind:"ModifyColumnNode",column:this.transformNode(e.column)}}transformAddConstraint(e){return{kind:"AddConstraintNode",constraint:this.transformNode(e.constraint)}}transformDropConstraint(e){return{kind:"DropConstraintNode",constraintName:this.transformNode(e.constraintName),ifExists:e.ifExists,modifier:e.modifier}}transformCreateView(e){return{kind:"CreateViewNode",name:this.transformNode(e.name),temporary:e.temporary,orReplace:e.orReplace,ifNotExists:e.ifNotExists,materialized:e.materialized,columns:this.transformNodeList(e.columns),as:this.transformNode(e.as)}}transformDropView(e){return{kind:"DropViewNode",name:this.transformNode(e.name),ifExists:e.ifExists,materialized:e.materialized,cascade:e.cascade}}transformGenerated(e){return{kind:"GeneratedNode",byDefault:e.byDefault,always:e.always,identity:e.identity,stored:e.stored,expression:this.transformNode(e.expression)}}transformDefaultValue(e){return{kind:"DefaultValueNode",defaultValue:this.transformNode(e.defaultValue)}}transformOn(e){return{kind:"OnNode",on:this.transformNode(e.on)}}transformSelectModifier(e){return{kind:"SelectModifierNode",modifier:e.modifier,rawModifier:this.transformNode(e.rawModifier),of:this.transformNodeList(e.of)}}transformCreateType(e){return{kind:"CreateTypeNode",name:this.transformNode(e.name),enum:this.transformNode(e.enum)}}transformDropType(e){return{kind:"DropTypeNode",name:this.transformNode(e.name),ifExists:e.ifExists}}transformExplain(e){return{kind:"ExplainNode",format:e.format,options:this.transformNode(e.options)}}transformSchemableIdentifier(e){return{kind:"SchemableIdentifierNode",schema:this.transformNode(e.schema),identifier:this.transformNode(e.identifier)}}transformAggregateFunction(e){return{kind:"AggregateFunctionNode",aggregated:this.transformNodeList(e.aggregated),distinct:e.distinct,filter:this.transformNode(e.filter),func:e.func,over:this.transformNode(e.over)}}transformOver(e){return{kind:"OverNode",orderBy:this.transformNode(e.orderBy),partitionBy:this.transformNode(e.partitionBy)}}transformPartitionBy(e){return{kind:"PartitionByNode",items:this.transformNodeList(e.items)}}transformPartitionByItem(e){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(e.partitionBy)}}transformBinaryOperation(e){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(e.leftOperand),operator:this.transformNode(e.operator),rightOperand:this.transformNode(e.rightOperand)}}transformUnaryOperation(e){return{kind:"UnaryOperationNode",operator:this.transformNode(e.operator),operand:this.transformNode(e.operand)}}transformUsing(e){return{kind:"UsingNode",tables:this.transformNodeList(e.tables)}}transformFunction(e){return{kind:"FunctionNode",func:e.func,arguments:this.transformNodeList(e.arguments)}}transformCase(e){return{kind:"CaseNode",value:this.transformNode(e.value),when:this.transformNodeList(e.when),else:this.transformNode(e.else),isStatement:e.isStatement}}transformWhen(e){return{kind:"WhenNode",condition:this.transformNode(e.condition),result:this.transformNode(e.result)}}transformJSONReference(e){return{kind:"JSONReferenceNode",reference:this.transformNode(e.reference),traversal:this.transformNode(e.traversal)}}transformJSONPath(e){return{kind:"JSONPathNode",inOperator:this.transformNode(e.inOperator),pathLegs:this.transformNodeList(e.pathLegs)}}transformJSONPathLeg(e){return{kind:"JSONPathLegNode",type:e.type,value:e.value}}transformJSONOperatorChain(e){return{kind:"JSONOperatorChainNode",operator:this.transformNode(e.operator),values:this.transformNodeList(e.values)}}transformTuple(e){return{kind:"TupleNode",values:this.transformNodeList(e.values)}}transformMergeQuery(e){return{kind:"MergeQueryNode",into:this.transformNode(e.into),using:this.transformNode(e.using),whens:this.transformNodeList(e.whens),with:this.transformNode(e.with),top:this.transformNode(e.top),output:this.transformNode(e.output)}}transformMatched(e){return{kind:"MatchedNode",not:e.not,bySource:e.bySource}}transformAddIndex(e){return{kind:"AddIndexNode",name:this.transformNode(e.name),columns:this.transformNodeList(e.columns),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists}}transformCast(e){return{kind:"CastNode",expression:this.transformNode(e.expression),dataType:this.transformNode(e.dataType)}}transformFetch(e){return{kind:"FetchNode",rowCount:this.transformNode(e.rowCount),modifier:e.modifier}}transformTop(e){return{kind:"TopNode",expression:e.expression,modifiers:e.modifiers}}transformOutput(e){return{kind:"OutputNode",selections:this.transformNodeList(e.selections)}}transformDataType(e){return e}transformSelectAll(e){return e}transformIdentifier(e){return e}transformValue(e){return e}transformPrimitiveValueList(e){return e}transformOperator(e){return e}transformDefaultInsertValue(e){return e}};var Ma=i({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0,MergeQueryNode:!0}),Ei=class extends He{#e;#t=new Set;#r=new Set;constructor(e){super(),this.#e=e}transformNodeImpl(e){if(!this.#i(e))return super.transformNodeImpl(e);let r=this.#a(e);for(let s of r)this.#r.add(s);let o=this.#o(e);for(let s of o)this.#t.add(s);let n=super.transformNodeImpl(e);for(let s of o)this.#t.delete(s);for(let s of r)this.#r.delete(s);return n}transformSchemableIdentifier(e){let r=super.transformSchemableIdentifier(e);return r.schema||!this.#t.has(e.identifier.name)?r:{...r,schema:N.create(this.#e)}}transformReferences(e){let r=super.transformReferences(e);return r.table.table.schema?r:{...r,table:ce.createWithSchema(this.#e,r.table.table.identifier.name)}}#i(e){return e.kind in Ma}#o(e){let r=new Set;if("name"in e&&e.name&&re.is(e.name)&&this.#s(e.name,r),"from"in e&&e.from)for(let o of e.from.froms)this.#n(o,r);if("into"in e&&e.into&&this.#n(e.into,r),"table"in e&&e.table&&this.#n(e.table,r),"joins"in e&&e.joins)for(let o of e.joins)this.#n(o.table,r);return"using"in e&&e.using&&this.#n(e.using,r),r}#a(e){let r=new Set;return"with"in e&&e.with&&this.#u(e.with,r),r}#n(e,r){let o=ce.is(e)?e:H.is(e)&&ce.is(e.node)?e.node:null;o&&this.#s(o.table,r)}#s(e,r){let o=e.identifier.name;!this.#t.has(o)&&!this.#r.has(o)&&r.add(o)}#u(e,r){for(let o of e.expressions){let n=o.name.table.table.identifier.name;this.#r.has(n)||r.add(n)}}};var ye=class{#e;constructor(e){this.#e=new Ei(e)}transformQuery(e){return this.#e.transformNode(e.node)}async transformResult(e){return e.result}};var Yn=i({is(t){return t.kind==="MatchedNode"},create(t,e=!1){return i({kind:"MatchedNode",not:t,bySource:e})}});function Lo(t,e,r){return Ue.create(St([Yn.create(!t.isMatched,t.bySource),...e&&e.length>0?[e.length===3&&r?U(e[0],e[1],e[2]):A(e)]:[]],"and",!1))}function Rt(t){return L(t)?R.create([t],[]):D(t)?t.toOperationNode():t}var Tr=class{#e;#t;#r;constructor(){this.#e=new Promise((e,r)=>{this.#r=r,this.#t=e})}get promise(){return this.#e}resolve=e=>{this.#t&&this.#t(e)};reject=e=>{this.#r&&this.#r(e)}};var Hn=new Set;function Zn(t){Hn.has(t)||(Hn.add(t),console.log(t))}var Fa=i([]),kt=class{#e;constructor(e=Fa){this.#e=e}get plugins(){return this.#e}transformQuery(e,r){for(let o of this.#e){let n=o.transformQuery({node:e,queryId:r});if(n.kind===e.kind)e=n;else throw new Error(["KyselyPlugin.transformQuery must return a node","of the same kind that was given to it.",`The plugin was given a ${e.kind}`,`but it returned a ${n.kind}`].join(" "))}return e}async executeQuery(e,r){return await this.provideConnection(async o=>{let n=await o.executeQuery(e),s=await this.#t(n,r);return Ua(n,s),s})}async*stream(e,r,o){let n=new Tr,s=new Tr;this.provideConnection(async u=>(n.resolve(u),await s.promise)).catch(u=>n.reject(u));let a=await n.promise;try{for await(let u of a.streamQuery(e,r))yield await this.#t(u,o)}finally{s.resolve()}}async#t(e,r){for(let o of this.#e)e=await o.transformResult({result:e,queryId:r});return e}};function Ua(t,e){let{numAffectedRows:r}=t;r===void 0&&t.numUpdatedOrDeletedRows===void 0||r!==void 0&&e.numAffectedRows!==void 0||Zn("kysely:warning: outdated driver/plugin detected! QueryResult.numUpdatedOrDeletedRows is deprecated and will be removed in a future release.")}var Po=class t extends kt{get adapter(){throw new Error("this query cannot be compiled to SQL")}compileQuery(){throw new Error("this query cannot be compiled to SQL")}provideConnection(){throw new Error("this query cannot be executed")}withConnectionProvider(){throw new Error("this query cannot have a connection provider")}withPlugin(e){return new t([...this.plugins,e])}withPlugins(e){return new t([...this.plugins,...e])}withPluginAtFront(e){return new t([e,...this.plugins])}withoutPlugins(){return new t([])}},Ze=new Po;var Ti=class{numChangedRows;constructor(e){this.numChangedRows=e}};var Ir=class t{#e;constructor(e){this.#e=i(e)}top(e,r){return new t({...this.#e,queryNode:l.cloneWithTop(this.#e.queryNode,Ne(e,r))})}using(...e){return new ze({...this.#e,queryNode:Q.cloneWithUsing(this.#e.queryNode,M("Using",e))})}output(e){return new t({...this.#e,queryNode:l.cloneWithOutput(this.#e.queryNode,J(e))})}outputAll(e){return new t({...this.#e,queryNode:l.cloneWithOutput(this.#e.queryNode,Z(e))})}};p(Ir,"don't await MergeQueryBuilder instances directly. To execute the query you need to call `execute` when available.");var ze=class t{#e;constructor(e){this.#e=i(e)}top(e,r){return new t({...this.#e,queryNode:l.cloneWithTop(this.#e.queryNode,Ne(e,r))})}whenMatched(){return this.#t([])}whenMatchedAnd(...e){return this.#t(e)}whenMatchedAndRef(e,r,o){return this.#t([e,r,o],!0)}#t(e,r){return new Cr({...this.#e,queryNode:Q.cloneWithWhen(this.#e.queryNode,Lo({isMatched:!0},e,r))})}whenNotMatched(){return this.#r([])}whenNotMatchedAnd(...e){return this.#r(e)}whenNotMatchedAndRef(e,r,o){return this.#r([e,r,o],!0)}whenNotMatchedBySource(){return this.#r([],!1,!0)}whenNotMatchedBySourceAnd(...e){return this.#r(e,!1,!0)}whenNotMatchedBySourceAndRef(e,r,o){return this.#r([e,r,o],!0,!0)}output(e){return new t({...this.#e,queryNode:l.cloneWithOutput(this.#e.queryNode,J(e))})}outputAll(e){return new t({...this.#e,queryNode:l.cloneWithOutput(this.#e.queryNode,Z(e))})}#r(e,r=!1,o=!1){let n={...this.#e,queryNode:Q.cloneWithWhen(this.#e.queryNode,Lo({isMatched:!1,bySource:o},e,r))},s=o?Cr:Ii;return new s(n)}$call(e){return e(this)}$if(e,r){return e?r(this):new t({...this.#e})}toOperationNode(){return this.#e.executor.transformQuery(this.#e.queryNode,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){let e=this.compile(),r=await this.#e.executor.executeQuery(e,this.#e.queryId);return e.query.output&&this.#e.executor.adapter.supportsOutput?r.rows:[new Ti(r.numAffectedRows)]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=pe){let r=await this.executeTakeFirst();if(r===void 0)throw Ae(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}};p(ze,"don't await WheneableMergeQueryBuilder instances directly. To execute the query you need to call `execute`.");var Cr=class{#e;constructor(e){this.#e=i(e)}thenDelete(){return new ze({...this.#e,queryNode:Q.cloneWithThen(this.#e.queryNode,Rt("delete"))})}thenDoNothing(){return new ze({...this.#e,queryNode:Q.cloneWithThen(this.#e.queryNode,Rt("do nothing"))})}thenUpdate(e){return new ze({...this.#e,queryNode:Q.cloneWithThen(this.#e.queryNode,Rt(e(new ct({queryId:this.#e.queryId,executor:Ze,queryNode:ve.createWithoutTable()}))))})}thenUpdateSet(...e){return this.thenUpdate(r=>r.set(...e))}};p(Cr,"don't await MatchedThenableMergeQueryBuilder instances directly. To execute the query you need to call `execute` when available.");var Ii=class{#e;constructor(e){this.#e=i(e)}thenDoNothing(){return new ze({...this.#e,queryNode:Q.cloneWithThen(this.#e.queryNode,Rt("do nothing"))})}thenInsertValues(e){let[r,o]=yi(e);return new ze({...this.#e,queryNode:Q.cloneWithThen(this.#e.queryNode,Rt(z.cloneWith(z.createWithoutInto(),{columns:r,values:o})))})}};p(Ii,"don't await NotMatchedThenableMergeQueryBuilder instances directly. To execute the query you need to call `execute` when available.");var Lt=class t{#e;constructor(e){this.#e=i(e)}selectFrom(e){return vr({queryId:T(),executor:this.#e.executor,queryNode:w.createFrom(We(e),this.#e.withNode)})}selectNoFrom(e){return vr({queryId:T(),executor:this.#e.executor,queryNode:w.cloneWithSelections(w.create(this.#e.withNode),J(e))})}insertInto(e){return new Wt({queryId:T(),executor:this.#e.executor,queryNode:z.create(I(e),this.#e.withNode)})}replaceInto(e){return new Wt({queryId:T(),executor:this.#e.executor,queryNode:z.create(I(e),this.#e.withNode,!0)})}deleteFrom(e){return new br({queryId:T(),executor:this.#e.executor,queryNode:Se.create(We(e),this.#e.withNode)})}updateTable(e){return new ct({queryId:T(),executor:this.#e.executor,queryNode:ve.create(et(e),this.#e.withNode)})}mergeInto(e){return new Ir({queryId:T(),executor:this.#e.executor,queryNode:Q.create(Bo(e),this.#e.withNode)})}with(e,r){let o=Ro(e,r);return new t({...this.#e,withNode:this.#e.withNode?Er.cloneWithExpression(this.#e.withNode,o):Er.create(o)})}withRecursive(e,r){let o=Ro(e,r);return new t({...this.#e,withNode:this.#e.withNode?Er.cloneWithExpression(this.#e.withNode,o):Er.create(o,{recursive:!0})})}withPlugin(e){return new t({...this.#e,executor:this.#e.executor.withPlugin(e)})}withoutPlugins(){return new t({...this.#e,executor:this.#e.executor.withoutPlugins()})}withSchema(e){return new t({...this.#e,executor:this.#e.executor.withPluginAtFront(new ye(e))})}};function Gn(){return new Lt({executor:Ze})}function es(t,e){return new yr({joinNode:Ge.create(t,et(e))})}function ts(){return new wr({overNode:Nr.create()})}function M(t,e){if(e.length===3)return Qa(t,e[0],e[1],e[2]);if(e.length===2)return za(t,e[0],e[1]);throw new Error("not implemented")}function za(t,e,r){return r(es(t,e)).toOperationNode()}function Qa(t,e,r,o){return Ge.createWithOn(t,et(e),U(r,"=",o))}var rs=i({is(t){return t.kind==="OffsetNode"},create(t){return i({kind:"OffsetNode",offset:t})}});var is=i({is(t){return t.kind==="GroupByItemNode"},create(t){return i({kind:"GroupByItemNode",groupBy:t})}});function os(t){return t=q(t)?t(fe()):t,Me(t).map(is.create)}var Ci=i({is(t){return t.kind==="SetOperationNode"},create(t,e,r){return i({kind:"SetOperationNode",operator:t,expression:e,all:r})}});function pt(t,e,r){return q(e)&&(e=e(vi())),_(e)||(e=[e]),e.map(o=>Ci.create(t,oe(o),r))}var C=class t{#e;constructor(e){this.#e=e}get expressionType(){}as(e){return new Sr(this,e)}or(...e){return new Mo(he.create(this.#e,A(e)))}and(...e){return new Fo(ie.create(this.#e,A(e)))}$castTo(){return new t(this.#e)}$notNull(){return new t(this.#e)}toOperationNode(){return this.#e}},Sr=class{#e;#t;constructor(e,r){this.#e=e,this.#t=r}get expression(){return this.#e}get alias(){return this.#t}toOperationNode(){return H.create(this.#e.toOperationNode(),D(this.#t)?this.#t.toOperationNode():N.create(this.#t))}},Mo=class t{#e;constructor(e){this.#e=e}get expressionType(){}as(e){return new Sr(this,e)}or(...e){return new t(he.create(this.#e,A(e)))}$castTo(){return new t(this.#e)}toOperationNode(){return Ce.create(this.#e)}},Fo=class t{#e;constructor(e){this.#e=e}get expressionType(){}as(e){return new Sr(this,e)}and(...e){return new t(ie.create(this.#e,A(e)))}$castTo(){return new t(this.#e)}toOperationNode(){return Ce.create(this.#e)}};var ns={is(t){return t.kind==="FetchNode"},create(t,e){return{kind:"FetchNode",rowCount:$.create(t),modifier:e}}};function ss(t,e){if(!je(t)&&!Ot(t))throw new Error(`Invalid fetch row count: ${t}`);if(!Va(e))throw new Error(`Invalid fetch modifier: ${e}`);return ns.create(t,e)}function Va(t){return t==="only"||t==="with ties"}var Si=class t{#e;constructor(e){this.#e=i(e)}get expressionType(){}get isSelectQueryBuilder(){return!0}where(...e){return new t({...this.#e,queryNode:l.cloneWithWhere(this.#e.queryNode,A(e))})}whereRef(e,r,o){return new t({...this.#e,queryNode:l.cloneWithWhere(this.#e.queryNode,U(e,r,o))})}having(...e){return new t({...this.#e,queryNode:w.cloneWithHaving(this.#e.queryNode,A(e))})}havingRef(e,r,o){return new t({...this.#e,queryNode:w.cloneWithHaving(this.#e.queryNode,U(e,r,o))})}select(e){return new t({...this.#e,queryNode:w.cloneWithSelections(this.#e.queryNode,J(e))})}distinctOn(e){return new t({...this.#e,queryNode:w.cloneWithDistinctOn(this.#e.queryNode,Me(e))})}modifyFront(e){return new t({...this.#e,queryNode:w.cloneWithFrontModifier(this.#e.queryNode,Ie.createWithExpression(e.toOperationNode()))})}modifyEnd(e){return new t({...this.#e,queryNode:w.cloneWithEndModifier(this.#e.queryNode,Ie.createWithExpression(e.toOperationNode()))})}distinct(){return new t({...this.#e,queryNode:w.cloneWithFrontModifier(this.#e.queryNode,Ie.create("Distinct"))})}forUpdate(e){return new t({...this.#e,queryNode:w.cloneWithEndModifier(this.#e.queryNode,Ie.create("ForUpdate",e?lr(e).map(I):void 0))})}forShare(e){return new t({...this.#e,queryNode:w.cloneWithEndModifier(this.#e.queryNode,Ie.create("ForShare",e?lr(e).map(I):void 0))})}forKeyShare(e){return new t({...this.#e,queryNode:w.cloneWithEndModifier(this.#e.queryNode,Ie.create("ForKeyShare",e?lr(e).map(I):void 0))})}forNoKeyUpdate(e){return new t({...this.#e,queryNode:w.cloneWithEndModifier(this.#e.queryNode,Ie.create("ForNoKeyUpdate",e?lr(e).map(I):void 0))})}skipLocked(){return new t({...this.#e,queryNode:w.cloneWithEndModifier(this.#e.queryNode,Ie.create("SkipLocked"))})}noWait(){return new t({...this.#e,queryNode:w.cloneWithEndModifier(this.#e.queryNode,Ie.create("NoWait"))})}selectAll(e){return new t({...this.#e,queryNode:w.cloneWithSelections(this.#e.queryNode,Z(e))})}innerJoin(...e){return new t({...this.#e,queryNode:l.cloneWithJoin(this.#e.queryNode,M("InnerJoin",e))})}leftJoin(...e){return new t({...this.#e,queryNode:l.cloneWithJoin(this.#e.queryNode,M("LeftJoin",e))})}rightJoin(...e){return new t({...this.#e,queryNode:l.cloneWithJoin(this.#e.queryNode,M("RightJoin",e))})}fullJoin(...e){return new t({...this.#e,queryNode:l.cloneWithJoin(this.#e.queryNode,M("FullJoin",e))})}innerJoinLateral(...e){return new t({...this.#e,queryNode:l.cloneWithJoin(this.#e.queryNode,M("LateralInnerJoin",e))})}leftJoinLateral(...e){return new t({...this.#e,queryNode:l.cloneWithJoin(this.#e.queryNode,M("LateralLeftJoin",e))})}orderBy(...e){return new t({...this.#e,queryNode:w.cloneWithOrderByItems(this.#e.queryNode,_e(e))})}groupBy(e){return new t({...this.#e,queryNode:w.cloneWithGroupByItems(this.#e.queryNode,os(e))})}limit(e){return new t({...this.#e,queryNode:w.cloneWithLimit(this.#e.queryNode,qt.create(v(e)))})}offset(e){return new t({...this.#e,queryNode:w.cloneWithOffset(this.#e.queryNode,rs.create(v(e)))})}fetch(e,r="only"){return new t({...this.#e,queryNode:w.cloneWithFetch(this.#e.queryNode,ss(e,r))})}top(e,r){return new t({...this.#e,queryNode:l.cloneWithTop(this.#e.queryNode,Ne(e,r))})}union(e){return new t({...this.#e,queryNode:w.cloneWithSetOperations(this.#e.queryNode,pt("union",e,!1))})}unionAll(e){return new t({...this.#e,queryNode:w.cloneWithSetOperations(this.#e.queryNode,pt("union",e,!0))})}intersect(e){return new t({...this.#e,queryNode:w.cloneWithSetOperations(this.#e.queryNode,pt("intersect",e,!1))})}intersectAll(e){return new t({...this.#e,queryNode:w.cloneWithSetOperations(this.#e.queryNode,pt("intersect",e,!0))})}except(e){return new t({...this.#e,queryNode:w.cloneWithSetOperations(this.#e.queryNode,pt("except",e,!1))})}exceptAll(e){return new t({...this.#e,queryNode:w.cloneWithSetOperations(this.#e.queryNode,pt("except",e,!0))})}as(e){return new Ai(this,e)}clearSelect(){return new t({...this.#e,queryNode:w.cloneWithoutSelections(this.#e.queryNode)})}clearWhere(){return new t({...this.#e,queryNode:l.cloneWithoutWhere(this.#e.queryNode)})}clearLimit(){return new t({...this.#e,queryNode:w.cloneWithoutLimit(this.#e.queryNode)})}clearOffset(){return new t({...this.#e,queryNode:w.cloneWithoutOffset(this.#e.queryNode)})}clearOrderBy(){return new t({...this.#e,queryNode:w.cloneWithoutOrderBy(this.#e.queryNode)})}clearGroupBy(){return new t({...this.#e,queryNode:w.cloneWithoutGroupBy(this.#e.queryNode)})}$call(e){return e(this)}$if(e,r){return e?r(this):new t({...this.#e})}$castTo(){return new t(this.#e)}$narrowType(){return new t(this.#e)}$assertType(){return new t(this.#e)}$asTuple(){return new C(this.toOperationNode())}withPlugin(e){return new t({...this.#e,executor:this.#e.executor.withPlugin(e)})}toOperationNode(){return this.#e.executor.transformQuery(this.#e.queryNode,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){let e=this.compile();return(await this.#e.executor.executeQuery(e,this.#e.queryId)).rows}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=pe){let r=await this.executeTakeFirst();if(r===void 0)throw Ae(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){let r=this.compile(),o=this.#e.executor.stream(r,e,this.#e.queryId);for await(let n of o)yield*n.rows}async explain(e,r){return await new t({...this.#e,queryNode:l.cloneWithExplain(this.#e.queryNode,e,r)}).execute()}};p(Si,"don't await SelectQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");function vr(t){return new Si(t)}var Ai=class{#e;#t;constructor(e,r){this.#e=e,this.#t=r}get expression(){return this.#e}get alias(){return this.#t}get isAliasedSelectQueryBuilder(){return!0}toOperationNode(){return H.create(this.#e.toOperationNode(),N.create(this.#t))}};p(Ai,"don't await AliasedSelectQueryBuilder instances directly. AliasedSelectQueryBuilder should never be executed directly since it's always a part of another query.");var Qe=i({is(t){return t.kind==="AggregateFunctionNode"},create(t,e=[]){return i({kind:"AggregateFunctionNode",func:t,aggregated:e})},cloneWithDistinct(t){return i({...t,distinct:!0})},cloneWithFilter(t,e){return i({...t,filter:t.filter?j.cloneWithOperation(t.filter,"And",e):j.create(e)})},cloneWithOrFilter(t,e){return i({...t,filter:t.filter?j.cloneWithOperation(t.filter,"Or",e):j.create(e)})},cloneWithOver(t,e){return i({...t,over:e})}});var Uo=i({is(t){return t.kind==="FunctionNode"},create(t,e){return i({kind:"FunctionNode",func:t,arguments:e})}});var lt=class t{#e;constructor(e){this.#e=i(e)}get expressionType(){}as(e){return new zo(this,e)}distinct(){return new t({...this.#e,aggregateFunctionNode:Qe.cloneWithDistinct(this.#e.aggregateFunctionNode)})}filterWhere(...e){return new t({...this.#e,aggregateFunctionNode:Qe.cloneWithFilter(this.#e.aggregateFunctionNode,A(e))})}filterWhereRef(e,r,o){return new t({...this.#e,aggregateFunctionNode:Qe.cloneWithFilter(this.#e.aggregateFunctionNode,U(e,r,o))})}over(e){let r=ts();return new t({...this.#e,aggregateFunctionNode:Qe.cloneWithOver(this.#e.aggregateFunctionNode,(e?e(r):r).toOperationNode())})}$call(e){return e(this)}$castTo(){return new t(this.#e)}$notNull(){return new t(this.#e)}toOperationNode(){return this.#e.aggregateFunctionNode}};p(lt,"don't await AggregateFunctionBuilder instances. They are never executed directly and are always just a part of a query.");var zo=class{#e;#t;constructor(e,r){this.#e=e,this.#t=r}get expression(){return this.#e}get alias(){return this.#t}toOperationNode(){return H.create(this.#e.toOperationNode(),N.create(this.#t))}};function Wi(){let t=(r,o)=>new C(Uo.create(r,Me(o??[]))),e=(r,o)=>new lt({aggregateFunctionNode:Qe.create(r,o?Me(o):void 0)});return Object.assign(t,{agg:e,avg(r){return e("avg",[r])},coalesce(...r){return t("coalesce",r)},count(r){return e("count",[r])},countAll(r){return new lt({aggregateFunctionNode:Qe.create("count",Z(r))})},max(r){return e("max",[r])},min(r){return e("min",[r])},sum(r){return e("sum",[r])},any(r){return t("any",[r])},jsonAgg(r){return new lt({aggregateFunctionNode:Qe.create("json_agg",[L(r)?I(r):r.toOperationNode()])})},toJson(r){return new C(Uo.create("to_json",[L(r)?I(r):r.toOperationNode()]))}})}var as=i({is(t){return t.kind==="UnaryOperationNode"},create(t,e){return i({kind:"UnaryOperationNode",operator:t,operand:e})}});function us(t,e){return as.create(ae.create(t),V(e))}var de=i({is(t){return t.kind==="CaseNode"},create(t){return i({kind:"CaseNode",value:t})},cloneWithWhen(t,e){return i({...t,when:i(t.when?[...t.when,e]:[e])})},cloneWithThen(t,e){return i({...t,when:t.when?i([...t.when.slice(0,-1),Ue.cloneWithResult(t.when[t.when.length-1],e)]):void 0})},cloneWith(t,e){return i({...t,...e})}});var Pt=class{#e;constructor(e){this.#e=i(e)}when(...e){return new qi({...this.#e,node:de.cloneWithWhen(this.#e.node,Ue.create(A(e)))})}},qi=class{#e;constructor(e){this.#e=i(e)}then(e){return new Qo({...this.#e,node:de.cloneWithThen(this.#e.node,hi(e)?fr(e):v(e))})}},Qo=class{#e;constructor(e){this.#e=i(e)}when(...e){return new qi({...this.#e,node:de.cloneWithWhen(this.#e.node,Ue.create(A(e)))})}else(e){return new Vo({...this.#e,node:de.cloneWith(this.#e.node,{else:hi(e)?fr(e):v(e)})})}end(){return new C(de.cloneWith(this.#e.node,{isStatement:!1}))}endCase(){return new C(de.cloneWith(this.#e.node,{isStatement:!0}))}},Vo=class{#e;constructor(e){this.#e=i(e)}end(){return new C(de.cloneWith(this.#e.node,{isStatement:!1}))}endCase(){return new C(de.cloneWith(this.#e.node,{isStatement:!0}))}};var $o=i({is(t){return t.kind==="JSONPathLegNode"},create(t,e){return i({kind:"JSONPathLegNode",type:t,value:e})}});var tt=class{#e;constructor(e){this.#e=e}at(e){return this.#t("ArrayLocation",e)}key(e){return this.#t("Member",e)}#t(e,r){return It.is(this.#e)?new Di(It.cloneWithTraversal(this.#e,Ye.is(this.#e.traversal)?Ye.cloneWithLeg(this.#e.traversal,$o.create(e,r)):li.cloneWithValue(this.#e.traversal,$.createImmediate(r)))):new Di(Ye.cloneWithLeg(this.#e,$o.create(e,r)))}},Di=class extends tt{#e;constructor(e){super(e),this.#e=e}get expressionType(){}as(e){return new Jo(this,e)}$castTo(){return new tt(this.#e)}$notNull(){return new tt(this.#e)}toOperationNode(){return this.#e}},Jo=class{#e;#t;constructor(e,r){this.#e=e,this.#t=r}get expression(){return this.#e}get alias(){return this.#t}toOperationNode(){return H.create(this.#e.toOperationNode(),D(this.#t)?this.#t.toOperationNode():N.create(this.#t))}};var jo=i({is(t){return t.kind==="TupleNode"},create(t){return i({kind:"TupleNode",values:i(t)})}});var $a=["varchar","char","text","integer","int2","int4","int8","smallint","bigint","boolean","real","double precision","float4","float8","decimal","numeric","binary","bytea","date","datetime","time","timetz","timestamp","timestamptz","serial","bigserial","uuid","json","jsonb","blob","varbinary"],Ja=[/^varchar\(\d+\)$/,/^char\(\d+\)$/,/^decimal\(\d+, \d+\)$/,/^numeric\(\d+, \d+\)$/,/^binary\(\d+\)$/,/^datetime\(\d+\)$/,/^time\(\d+\)$/,/^timetz\(\d+\)$/,/^timestamp\(\d+\)$/,/^timestamptz\(\d+\)$/,/^varbinary\(\d+\)$/],ds=i({is(t){return t.kind==="DataTypeNode"},create(t){return i({kind:"DataTypeNode",dataType:t})}});function cs(t){return!!($a.includes(t)||Ja.some(e=>e.test(t)))}function we(t){if(D(t))return t.toOperationNode();if(cs(t))return ds.create(t);throw new Error(`invalid column data type ${JSON.stringify(t)}`)}var ps=i({is(t){return t.kind==="CastNode"},create(t,e){return i({kind:"CastNode",expression:t,dataType:e})}});function vi(t=Ze){function e(n,s,a){return new C(fi(n,s,a))}function r(n,s){return new C(us(n,s))}let o=Object.assign(e,{fn:void 0,eb:void 0,selectFrom(n){return vr({queryId:T(),executor:t,queryNode:w.createFrom(We(n))})},case(n){return new Pt({node:de.create(se(n)?void 0:V(n))})},ref(n,s){return se(s)?new C(ue(n)):new tt(Dn(n,s))},jsonPath(){return new tt(Ye.create())},table(n){return new C(I(n))},val(n){return new C(v(n))},refTuple(...n){return new C(jo.create(n.map(V)))},tuple(...n){return new C(jo.create(n.map(v)))},lit(n){return new C(fr(n))},unary:r,not(n){return r("not",n)},exists(n){return r("exists",n)},neg(n){return r("-",n)},between(n,s,a){return new C(Xe.create(V(n),ae.create("between"),ie.create(v(s),v(a))))},betweenSymmetric(n,s,a){return new C(Xe.create(V(n),ae.create("between symmetric"),ie.create(v(s),v(a))))},and(n){return _(n)?new C(St(n,"and")):new C(To(n,"and"))},or(n){return _(n)?new C(St(n,"or")):new C(To(n,"or"))},parens(...n){let s=A(n);return Ce.is(s)?new C(s):new C(Ce.create(s))},cast(n,s){return new C(ps.create(V(n),we(s)))},withSchema(n){return vi(t.withPluginAtFront(new ye(n)))}});return o.fn=Wi(),o.eb=o,o}function fe(t){return vi()}function oe(t){if(D(t))return t.toOperationNode();if(q(t))return t(fe()).toOperationNode();throw new Error(`invalid expression: ${JSON.stringify(t)}`)}function Ni(t){if(D(t))return t.toOperationNode();if(q(t))return t(fe()).toOperationNode();throw new Error(`invalid aliased expression: ${JSON.stringify(t)}`)}function Be(t){return vn(t)||Sn(t)||q(t)}function We(t){return _(t)?t.map(e=>et(e)):[et(t)]}function et(t){return L(t)?Bo(t):Ni(t)}function Bo(t){let e=" as ";if(t.includes(e)){let[r,o]=t.split(e).map(ls);return H.create(I(r),N.create(o))}else return I(t)}function I(t){let e=".";if(t.includes(e)){let[r,o]=t.split(e).map(ls);return ce.createWithSchema(r,o)}else return ce.create(t)}function ls(t){return t.trim()}var Ko=i({is(t){return t.kind==="AddColumnNode"},create(t){return i({kind:"AddColumnNode",column:t})}});var W=i({is(t){return t.kind==="ColumnDefinitionNode"},create(t,e){return i({kind:"ColumnDefinitionNode",column:b.create(t),dataType:e})},cloneWithFrontModifier(t,e){return i({...t,frontModifiers:t.frontModifiers?i([...t.frontModifiers,e]):[e]})},cloneWithEndModifier(t,e){return i({...t,endModifiers:t.endModifiers?i([...t.endModifiers,e]):[e]})},cloneWith(t,e){return i({...t,...e})}});var Go=i({is(t){return t.kind==="DropColumnNode"},create(t){return i({kind:"DropColumnNode",column:b.create(t)})}});var Xo=i({is(t){return t.kind==="RenameColumnNode"},create(t,e){return i({kind:"RenameColumnNode",column:b.create(t),renameTo:b.create(e)})}});var Bt=i({is(t){return t.kind==="CheckConstraintNode"},create(t,e){return i({kind:"CheckConstraintNode",expression:t,name:e?N.create(e):void 0})}});var ms=["no action","restrict","cascade","set null","set default"],Mt=i({is(t){return t.kind==="ReferencesNode"},create(t,e){return i({kind:"ReferencesNode",table:t,columns:i([...e])})},cloneWithOnDelete(t,e){return i({...t,onDelete:e})},cloneWithOnUpdate(t,e){return i({...t,onUpdate:e})}});function Ri(t){return D(t)?t.toOperationNode():$.createImmediate(t)}var Ar=i({is(t){return t.kind==="GeneratedNode"},create(t){return i({kind:"GeneratedNode",...t})},createWithExpression(t){return i({kind:"GeneratedNode",always:!0,expression:t})},cloneWith(t,e){return i({...t,...e})}});var hs=i({is(t){return t.kind==="DefaultValueNode"},create(t){return i({kind:"DefaultValueNode",defaultValue:t})}});function Ft(t){if(ms.includes(t))return t;throw new Error(`invalid OnModifyForeignAction ${t}`)}var qe=class t{#e;constructor(e){this.#e=e}autoIncrement(){return new t(W.cloneWith(this.#e,{autoIncrement:!0}))}identity(){return new t(W.cloneWith(this.#e,{identity:!0}))}primaryKey(){return new t(W.cloneWith(this.#e,{primaryKey:!0}))}references(e){let r=ue(e);if(!r.table||Et.is(r.column))throw new Error(`invalid call references('${e}'). The reference must have format table.column or schema.table.column`);return new t(W.cloneWith(this.#e,{references:Mt.create(r.table,[r.column])}))}onDelete(e){if(!this.#e.references)throw new Error("on delete constraint can only be added for foreign keys");return new t(W.cloneWith(this.#e,{references:Mt.cloneWithOnDelete(this.#e.references,Ft(e))}))}onUpdate(e){if(!this.#e.references)throw new Error("on update constraint can only be added for foreign keys");return new t(W.cloneWith(this.#e,{references:Mt.cloneWithOnUpdate(this.#e.references,Ft(e))}))}unique(){return new t(W.cloneWith(this.#e,{unique:!0}))}notNull(){return new t(W.cloneWith(this.#e,{notNull:!0}))}unsigned(){return new t(W.cloneWith(this.#e,{unsigned:!0}))}defaultTo(e){return new t(W.cloneWith(this.#e,{defaultTo:hs.create(Ri(e))}))}check(e){return new t(W.cloneWith(this.#e,{check:Bt.create(e.toOperationNode())}))}generatedAlwaysAs(e){return new t(W.cloneWith(this.#e,{generated:Ar.createWithExpression(e.toOperationNode())}))}generatedAlwaysAsIdentity(){return new t(W.cloneWith(this.#e,{generated:Ar.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new t(W.cloneWith(this.#e,{generated:Ar.create({identity:!0,byDefault:!0})}))}stored(){if(!this.#e.generated)throw new Error("stored() can only be called after generatedAlwaysAs");return new t(W.cloneWith(this.#e,{generated:Ar.cloneWith(this.#e.generated,{stored:!0})}))}modifyFront(e){return new t(W.cloneWithFrontModifier(this.#e,e.toOperationNode()))}nullsNotDistinct(){return new t(W.cloneWith(this.#e,{nullsNotDistinct:!0}))}ifNotExists(){return new t(W.cloneWith(this.#e,{ifNotExists:!0}))}modifyEnd(e){return new t(W.cloneWithEndModifier(this.#e,e.toOperationNode()))}$call(e){return e(this)}toOperationNode(){return this.#e}};p(qe,"don't await ColumnDefinitionBuilder instances directly.");var _o=i({is(t){return t.kind==="ModifyColumnNode"},create(t){return i({kind:"ModifyColumnNode",column:t})}});var mt=i({is(t){return t.kind==="ForeignKeyConstraintNode"},create(t,e,r,o){return i({kind:"ForeignKeyConstraintNode",columns:t,references:Mt.create(e,r),name:o?N.create(o):void 0})},cloneWith(t,e){return i({...t,...e})}});var ht=class t{#e;constructor(e){this.#e=e}onDelete(e){return new t(mt.cloneWith(this.#e,{onDelete:Ft(e)}))}onUpdate(e){return new t(mt.cloneWith(this.#e,{onUpdate:Ft(e)}))}$call(e){return e(this)}toOperationNode(){return this.#e}};p(ht,"don't await ForeignKeyConstraintBuilder instances directly.");var Ut=i({is(t){return t.kind==="AddConstraintNode"},create(t){return i({kind:"AddConstraintNode",constraint:t})}});var zt=i({is(t){return t.kind==="UniqueConstraintNode"},create(t,e,r){return i({kind:"UniqueConstraintNode",columns:i(t.map(b.create)),name:e?N.create(e):void 0,nullsNotDistinct:r})},cloneWith(t,e){return i({...t,...e})}});var Qt=i({is(t){return t.kind==="DropConstraintNode"},create(t){return i({kind:"DropConstraintNode",constraintName:N.create(t)})},cloneWith(t,e){return i({...t,...e})}});var Vt=i({is(t){return t.kind==="AlterColumnNode"},create(t,e,r){return i({kind:"AlterColumnNode",column:b.create(t),[e]:r})}});var $t=class{#e;constructor(e){this.#e=e}setDataType(e){return new rt(Vt.create(this.#e,"dataType",we(e)))}setDefault(e){return new rt(Vt.create(this.#e,"setDefault",Ri(e)))}dropDefault(){return new rt(Vt.create(this.#e,"dropDefault",!0))}setNotNull(){return new rt(Vt.create(this.#e,"setNotNull",!0))}dropNotNull(){return new rt(Vt.create(this.#e,"dropNotNull",!0))}$call(e){return e(this)}};p($t,"don't await AlterColumnBuilder instances");var rt=class{#e;constructor(e){this.#e=e}toOperationNode(){return this.#e}};p(rt,"don't await AlteredColumnBuilder instances");var De=class{#e;constructor(e){this.#e=i(e)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};p(De,"don't await AlterTableExecutor instances directly. To execute the query you need to call `execute`");var Wr=class t{#e;constructor(e){this.#e=i(e)}onDelete(e){return new t({...this.#e,constraintBuilder:this.#e.constraintBuilder.onDelete(e)})}onUpdate(e){return new t({...this.#e,constraintBuilder:this.#e.constraintBuilder.onUpdate(e)})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(E.cloneWithTableProps(this.#e.node,{addConstraint:Ut.create(this.#e.constraintBuilder.toOperationNode())}),this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};p(Wr,"don't await AlterTableAddForeignKeyConstraintBuilder instances directly. To execute the query you need to call `execute`");var qr=class t{#e;constructor(e){this.#e=i(e)}ifExists(){return new t({...this.#e,node:E.cloneWithTableProps(this.#e.node,{dropConstraint:Qt.cloneWith(this.#e.node.dropConstraint,{ifExists:!0})})})}cascade(){return new t({...this.#e,node:E.cloneWithTableProps(this.#e.node,{dropConstraint:Qt.cloneWith(this.#e.node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new t({...this.#e,node:E.cloneWithTableProps(this.#e.node,{dropConstraint:Qt.cloneWith(this.#e.node.dropConstraint,{modifier:"restrict"})})})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};p(qr,"don't await AlterTableDropConstraintBuilder instances directly. To execute the query you need to call `execute`");var ki=i({is(t){return t.kind==="PrimaryKeyConstraintNode"},create(t,e){return i({kind:"PrimaryKeyConstraintNode",columns:i(t.map(b.create)),name:e?N.create(e):void 0})}});var it=i({is(t){return t.kind==="AddIndexNode"},create(t){return i({kind:"AddIndexNode",name:N.create(t)})},cloneWith(t,e){return i({...t,...e})},cloneWithColumns(t,e){return i({...t,columns:[...t.columns||[],...e]})}});var Dr=class t{#e;constructor(e){this.#e=i(e)}unique(){return new t({...this.#e,node:E.cloneWithTableProps(this.#e.node,{addIndex:it.cloneWith(this.#e.node.addIndex,{unique:!0})})})}column(e){return new t({...this.#e,node:E.cloneWithTableProps(this.#e.node,{addIndex:it.cloneWithColumns(this.#e.node.addIndex,[Ct(e)])})})}columns(e){return new t({...this.#e,node:E.cloneWithTableProps(this.#e.node,{addIndex:it.cloneWithColumns(this.#e.node.addIndex,e.map(Ct))})})}expression(e){return new t({...this.#e,node:E.cloneWithTableProps(this.#e.node,{addIndex:it.cloneWithColumns(this.#e.node.addIndex,[e.toOperationNode()])})})}using(e){return new t({...this.#e,node:E.cloneWithTableProps(this.#e.node,{addIndex:it.cloneWith(this.#e.node.addIndex,{using:R.createWithSql(e)})})})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};p(Dr,"don't await AlterTableAddIndexBuilder instances directly. To execute the query you need to call `execute`");var ft=class t{#e;constructor(e){this.#e=e}toOperationNode(){return this.#e}nullsNotDistinct(){return new t(zt.cloneWith(this.#e,{nullsNotDistinct:!0}))}};p(ft,"don't await UniqueConstraintNodeBuilder instances directly.");var Rr=class{#e;constructor(e){this.#e=i(e)}renameTo(e){return new De({...this.#e,node:E.cloneWithTableProps(this.#e.node,{renameTo:I(e)})})}setSchema(e){return new De({...this.#e,node:E.cloneWithTableProps(this.#e.node,{setSchema:N.create(e)})})}alterColumn(e,r){let o=r(new $t(e));return new ot({...this.#e,node:E.cloneWithColumnAlteration(this.#e.node,o.toOperationNode())})}dropColumn(e){return new ot({...this.#e,node:E.cloneWithColumnAlteration(this.#e.node,Go.create(e))})}renameColumn(e,r){return new ot({...this.#e,node:E.cloneWithColumnAlteration(this.#e.node,Xo.create(e,r))})}addColumn(e,r,o=Te){let n=o(new qe(W.create(e,we(r))));return new ot({...this.#e,node:E.cloneWithColumnAlteration(this.#e.node,Ko.create(n.toOperationNode()))})}modifyColumn(e,r,o=Te){let n=o(new qe(W.create(e,we(r))));return new ot({...this.#e,node:E.cloneWithColumnAlteration(this.#e.node,_o.create(n.toOperationNode()))})}addUniqueConstraint(e,r,o=Te){let n=o(new ft(zt.create(r,e)));return new De({...this.#e,node:E.cloneWithTableProps(this.#e.node,{addConstraint:Ut.create(n.toOperationNode())})})}addCheckConstraint(e,r){return new De({...this.#e,node:E.cloneWithTableProps(this.#e.node,{addConstraint:Ut.create(Bt.create(r.toOperationNode(),e))})})}addForeignKeyConstraint(e,r,o,n){return new Wr({...this.#e,constraintBuilder:new ht(mt.create(r.map(b.create),I(o),n.map(b.create),e))})}addPrimaryKeyConstraint(e,r){return new De({...this.#e,node:E.cloneWithTableProps(this.#e.node,{addConstraint:Ut.create(ki.create(r,e))})})}dropConstraint(e){return new qr({...this.#e,node:E.cloneWithTableProps(this.#e.node,{dropConstraint:Qt.create(e)})})}addIndex(e){return new Dr({...this.#e,node:E.cloneWithTableProps(this.#e.node,{addIndex:it.create(e)})})}dropIndex(e){return new De({...this.#e,node:E.cloneWithTableProps(this.#e.node,{dropIndex:Ke.create(e)})})}$call(e){return e(this)}};p(Rr,"don't await AlterTableBuilder instances");var ot=class t{#e;constructor(e){this.#e=i(e)}alterColumn(e,r){let o=r(new $t(e));return new t({...this.#e,node:E.cloneWithColumnAlteration(this.#e.node,o.toOperationNode())})}dropColumn(e){return new t({...this.#e,node:E.cloneWithColumnAlteration(this.#e.node,Go.create(e))})}renameColumn(e,r){return new t({...this.#e,node:E.cloneWithColumnAlteration(this.#e.node,Xo.create(e,r))})}addColumn(e,r,o=Te){let n=o(new qe(W.create(e,we(r))));return new t({...this.#e,node:E.cloneWithColumnAlteration(this.#e.node,Ko.create(n.toOperationNode()))})}modifyColumn(e,r,o=Te){let n=o(new qe(W.create(e,we(r))));return new t({...this.#e,node:E.cloneWithColumnAlteration(this.#e.node,_o.create(n.toOperationNode()))})}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};p(ot,"don't await AlterTableColumnAlteringBuilder instances directly. To execute the query you need to call `execute`");var Jt=class extends He{transformValue(e){return{...super.transformValue(e),immediate:!0}}};var kr=class t{#e;constructor(e){this.#e=i(e)}ifNotExists(){return new t({...this.#e,node:me.cloneWith(this.#e.node,{ifNotExists:!0})})}unique(){return new t({...this.#e,node:me.cloneWith(this.#e.node,{unique:!0})})}nullsNotDistinct(){return new t({...this.#e,node:me.cloneWith(this.#e.node,{nullsNotDistinct:!0})})}on(e){return new t({...this.#e,node:me.cloneWith(this.#e.node,{table:I(e)})})}column(e){return new t({...this.#e,node:me.cloneWithColumns(this.#e.node,[Ct(e)])})}columns(e){return new t({...this.#e,node:me.cloneWithColumns(this.#e.node,e.map(Ct))})}expression(e){return new t({...this.#e,node:me.cloneWithColumns(this.#e.node,[e.toOperationNode()])})}using(e){return new t({...this.#e,node:me.cloneWith(this.#e.node,{using:R.createWithSql(e)})})}where(...e){let r=new Jt;return new t({...this.#e,node:l.cloneWithWhere(this.#e.node,r.transformNode(A(e)))})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};p(kr,"don't await CreateIndexBuilder instances directly. To execute the query you need to call `execute`");var Lr=class t{#e;constructor(e){this.#e=i(e)}ifNotExists(){return new t({...this.#e,node:ai.cloneWith(this.#e.node,{ifNotExists:!0})})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};p(Lr,"don't await CreateSchemaBuilder instances directly. To execute the query you need to call `execute`");function fs(t){if(Cn.includes(t))return t;throw new Error(`invalid OnCommitAction ${t}`)}var Pr=class t{#e;constructor(e){this.#e=i(e)}temporary(){return new t({...this.#e,node:Y.cloneWith(this.#e.node,{temporary:!0})})}onCommit(e){return new t({...this.#e,node:Y.cloneWith(this.#e.node,{onCommit:fs(e)})})}ifNotExists(){return new t({...this.#e,node:Y.cloneWith(this.#e.node,{ifNotExists:!0})})}addColumn(e,r,o=Te){let n=o(new qe(W.create(e,we(r))));return new t({...this.#e,node:Y.cloneWithColumn(this.#e.node,n.toOperationNode())})}addPrimaryKeyConstraint(e,r){return new t({...this.#e,node:Y.cloneWithConstraint(this.#e.node,ki.create(r,e))})}addUniqueConstraint(e,r,o=Te){let n=o(new ft(zt.create(r,e)));return new t({...this.#e,node:Y.cloneWithConstraint(this.#e.node,n.toOperationNode())})}addCheckConstraint(e,r){return new t({...this.#e,node:Y.cloneWithConstraint(this.#e.node,Bt.create(r.toOperationNode(),e))})}addForeignKeyConstraint(e,r,o,n,s=Te){let a=s(new ht(mt.create(r.map(b.create),I(o),n.map(b.create),e)));return new t({...this.#e,node:Y.cloneWithConstraint(this.#e.node,a.toOperationNode())})}modifyFront(e){return new t({...this.#e,node:Y.cloneWithFrontModifier(this.#e.node,e.toOperationNode())})}modifyEnd(e){return new t({...this.#e,node:Y.cloneWithEndModifier(this.#e.node,e.toOperationNode())})}as(e){return new t({...this.#e,node:Y.cloneWith(this.#e.node,{selectQuery:oe(e)})})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};p(Pr,"don't await CreateTableBuilder instances directly. To execute the query you need to call `execute`");var Br=class t{#e;constructor(e){this.#e=i(e)}on(e){return new t({...this.#e,node:Ke.cloneWith(this.#e.node,{table:I(e)})})}ifExists(){return new t({...this.#e,node:Ke.cloneWith(this.#e.node,{ifExists:!0})})}cascade(){return new t({...this.#e,node:Ke.cloneWith(this.#e.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};p(Br,"don't await DropIndexBuilder instances directly. To execute the query you need to call `execute`");var Mr=class t{#e;constructor(e){this.#e=i(e)}ifExists(){return new t({...this.#e,node:mr.cloneWith(this.#e.node,{ifExists:!0})})}cascade(){return new t({...this.#e,node:mr.cloneWith(this.#e.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};p(Mr,"don't await DropSchemaBuilder instances directly. To execute the query you need to call `execute`");var Fr=class t{#e;constructor(e){this.#e=i(e)}ifExists(){return new t({...this.#e,node:hr.cloneWith(this.#e.node,{ifExists:!0})})}cascade(){return new t({...this.#e,node:hr.cloneWith(this.#e.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};p(Fr,"don't await DropTableBuilder instances directly. To execute the query you need to call `execute`");var xe=i({is(t){return t.kind==="CreateViewNode"},create(t){return i({kind:"CreateViewNode",name:re.create(t)})},cloneWith(t,e){return i({...t,...e})}});var Li=class{#e=new Jt;transformQuery(e){return this.#e.transformNode(e.node)}transformResult(e){return Promise.resolve(e.result)}};var Ur=class t{#e;constructor(e){this.#e=i(e)}temporary(){return new t({...this.#e,node:xe.cloneWith(this.#e.node,{temporary:!0})})}materialized(){return new t({...this.#e,node:xe.cloneWith(this.#e.node,{materialized:!0})})}ifNotExists(){return new t({...this.#e,node:xe.cloneWith(this.#e.node,{ifNotExists:!0})})}orReplace(){return new t({...this.#e,node:xe.cloneWith(this.#e.node,{orReplace:!0})})}columns(e){return new t({...this.#e,node:xe.cloneWith(this.#e.node,{columns:e.map(bo)})})}as(e){let r=e.withPlugin(new Li).toOperationNode();return new t({...this.#e,node:xe.cloneWith(this.#e.node,{as:r})})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};p(Ur,"don't await CreateViewBuilder instances directly. To execute the query you need to call `execute`");var jt=i({is(t){return t.kind==="DropViewNode"},create(t){return i({kind:"DropViewNode",name:re.create(t)})},cloneWith(t,e){return i({...t,...e})}});var zr=class t{#e;constructor(e){this.#e=i(e)}materialized(){return new t({...this.#e,node:jt.cloneWith(this.#e.node,{materialized:!0})})}ifExists(){return new t({...this.#e,node:jt.cloneWith(this.#e.node,{ifExists:!0})})}cascade(){return new t({...this.#e,node:jt.cloneWith(this.#e.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};p(zr,"don't await DropViewBuilder instances directly. To execute the query you need to call `execute`");var Pi=i({is(t){return t.kind==="CreateTypeNode"},create(t){return i({kind:"CreateTypeNode",name:t})},cloneWithEnum(t,e){return i({...t,enum:vt.create(e.map(r=>$.createImmediate(r)))})}});var Qr=class t{#e;constructor(e){this.#e=i(e)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}asEnum(e){return new t({...this.#e,node:Pi.cloneWithEnum(this.#e.node,e)})}$call(e){return e(this)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};p(Qr,"don't await CreateTypeBuilder instances directly. To execute the query you need to call `execute`");var Bi=i({is(t){return t.kind==="DropTypeNode"},create(t){return i({kind:"DropTypeNode",name:t})},cloneWith(t,e){return i({...t,...e})}});var Vr=class t{#e;constructor(e){this.#e=i(e)}ifExists(){return new t({...this.#e,node:Bi.cloneWith(this.#e.node,{ifExists:!0})})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};p(Vr,"don't await DropTypeBuilder instances directly. To execute the query you need to call `execute`");function Yo(t){let e=".";if(t.includes(e)){let r=t.split(e).map(ja);if(r.length===2)return re.createWithSchema(r[0],r[1]);throw new Error(`invalid schemable identifier ${t}`)}else return re.create(t)}function ja(t){return t.trim()}var Mi=class t{#e;constructor(e){this.#e=e}createTable(e){return new Pr({queryId:T(),executor:this.#e,node:Y.create(I(e))})}dropTable(e){return new Fr({queryId:T(),executor:this.#e,node:hr.create(I(e))})}createIndex(e){return new kr({queryId:T(),executor:this.#e,node:me.create(e)})}dropIndex(e){return new Br({queryId:T(),executor:this.#e,node:Ke.create(e)})}createSchema(e){return new Lr({queryId:T(),executor:this.#e,node:ai.create(e)})}dropSchema(e){return new Mr({queryId:T(),executor:this.#e,node:mr.create(e)})}alterTable(e){return new Rr({queryId:T(),executor:this.#e,node:E.create(I(e))})}createView(e){return new Ur({queryId:T(),executor:this.#e,node:xe.create(e)})}dropView(e){return new zr({queryId:T(),executor:this.#e,node:jt.create(e)})}createType(e){return new Qr({queryId:T(),executor:this.#e,node:Pi.create(Yo(e))})}dropType(e){return new Vr({queryId:T(),executor:this.#e,node:Bi.create(Yo(e))})}withPlugin(e){return new t(this.#e.withPlugin(e))}withoutPlugins(){return new t(this.#e.withoutPlugins())}withSchema(e){return new t(this.#e.withPluginAtFront(new ye(e)))}};var Fi=class{ref(e){return new di(e)}};var Ui=class{#e;constructor(e){this.#e=e}async provideConnection(e){let r=await this.#e.acquireConnection();try{return await e(r)}finally{await this.#e.releaseConnection(r)}}};var zi=class t extends kt{#e;#t;#r;constructor(e,r,o,n=[]){super(n),this.#e=e,this.#t=r,this.#r=o}get adapter(){return this.#t}compileQuery(e){return this.#e.compileQuery(e)}provideConnection(e){return this.#r.provideConnection(e)}withPlugins(e){return new t(this.#e,this.#t,this.#r,[...this.plugins,...e])}withPlugin(e){return new t(this.#e,this.#t,this.#r,[...this.plugins,e])}withPluginAtFront(e){return new t(this.#e,this.#t,this.#r,[e,...this.plugins])}withConnectionProvider(e){return new t(this.#e,this.#t,e,[...this.plugins])}withoutPlugins(){return new t(this.#e,this.#t,this.#r,[])}};function Ho(){return typeof performance<"u"&&q(performance.now)?performance.now():Date.now()}var Qi=class{#e;#t;#r;#i;#o;#a=new WeakSet;constructor(e,r){this.#i=!1,this.#e=e,this.#t=r}async init(){if(this.#o)throw new Error("driver has already been destroyed");this.#r||(this.#r=this.#e.init().then(()=>{this.#i=!0}).catch(e=>(this.#r=void 0,Promise.reject(e)))),await this.#r}async acquireConnection(){if(this.#o)throw new Error("driver has already been destroyed");this.#i||await this.init();let e=await this.#e.acquireConnection();return this.#a.has(e)||(this.#n()&&this.#s(e),this.#a.add(e)),e}async releaseConnection(e){await this.#e.releaseConnection(e)}beginTransaction(e,r){return this.#e.beginTransaction(e,r)}commitTransaction(e){return this.#e.commitTransaction(e)}rollbackTransaction(e){return this.#e.rollbackTransaction(e)}async destroy(){this.#r&&(await this.#r,this.#o||(this.#o=this.#e.destroy().catch(e=>(this.#o=void 0,Promise.reject(e)))),await this.#o)}#n(){return this.#t.isLevelEnabled("query")||this.#t.isLevelEnabled("error")}#s(e){let r=e.executeQuery;e.executeQuery=async o=>{let n,s=Ho();try{return await r.call(e,o)}catch(a){throw n=a,await this.#u(a,o,s),a}finally{n||await this.#c(o,s)}}}async#u(e,r,o){await this.#t.error(()=>({level:"error",error:e,query:r,queryDurationMillis:this.#d(o)}))}async#c(e,r){await this.#t.query(()=>({level:"query",query:e,queryDurationMillis:this.#d(r)}))}#d(e){return Ho()-e}};var Ka=()=>{},$r=class{#e;#t;constructor(e){this.#e=e}async provideConnection(e){for(;this.#t;)await this.#t.catch(Ka);return this.#t=this.#r(e).finally(()=>{this.#t=void 0}),this.#t}async#r(e){return await e(this.#e)}};var Ns=["read uncommitted","read committed","repeatable read","serializable","snapshot"];var RT=i(["query","error"]),Vi=class{#e;#t;constructor(e){q(e)?(this.#t=e,this.#e=i({query:!0,error:!0})):(this.#t=Ga,this.#e=i({query:e.includes("query"),error:e.includes("error")}))}isLevelEnabled(e){return this.#e[e]}async query(e){this.#e.query&&await this.#t(e())}async error(e){this.#e.error&&await this.#t(e())}};function Ga(t){t.level==="query"?(console.log(`kysely:query: ${t.query.sql}`),console.log(`kysely:query: duration: ${t.queryDurationMillis.toFixed(1)}ms`)):t.level==="error"&&(t.error instanceof Error?console.error(`kysely:error: ${t.error.stack??t.error.message}`):console.error(`kysely:error: ${JSON.stringify({error:t.error,query:t.query.sql,queryDurationMillis:t.queryDurationMillis})}`))}function ys(t){return X(t)&&q(t.compile)}var Kt=class t extends Lt{#e;constructor(e){let r,o;if(Xa(e))r={executor:e.executor},o={...e};else{let n=e.dialect,s=n.createDriver(),a=n.createQueryCompiler(),u=n.createAdapter(),d=new Vi(e.log??[]),c=new Qi(s,d),y=new Ui(c),f=new zi(a,u,y,e.plugins??[]);r={executor:f},o={config:e,executor:f,dialect:n,driver:c}}super(r),this.#e=i(o)}get schema(){return new Mi(this.#e.executor)}get dynamic(){return new Fi}get introspection(){return this.#e.dialect.createIntrospector(this.withoutPlugins())}case(e){return new Pt({node:de.create(se(e)?void 0:oe(e))})}get fn(){return Wi()}transaction(){return new Ji({...this.#e})}connection(){return new $i({...this.#e})}withPlugin(e){return new t({...this.#e,executor:this.#e.executor.withPlugin(e)})}withoutPlugins(){return new t({...this.#e,executor:this.#e.executor.withoutPlugins()})}withSchema(e){return new t({...this.#e,executor:this.#e.executor.withPluginAtFront(new ye(e))})}withTables(){return new t({...this.#e})}async destroy(){await this.#e.driver.destroy()}get isTransaction(){return!1}getExecutor(){return this.#e.executor}executeQuery(e,r=T()){let o=ys(e)?e.compile():e;return this.getExecutor().executeQuery(o,r)}},Zo=class t extends Kt{#e;constructor(e){super(e),this.#e=e}get isTransaction(){return!0}transaction(){throw new Error("calling the transaction method for a Transaction is not supported")}connection(){throw new Error("calling the connection method for a Transaction is not supported")}async destroy(){throw new Error("calling the destroy method for a Transaction is not supported")}withPlugin(e){return new t({...this.#e,executor:this.#e.executor.withPlugin(e)})}withoutPlugins(){return new t({...this.#e,executor:this.#e.executor.withoutPlugins()})}withSchema(e){return new t({...this.#e,executor:this.#e.executor.withPluginAtFront(new ye(e))})}withTables(){return new t({...this.#e})}};function Xa(t){return X(t)&&X(t.config)&&X(t.driver)&&X(t.executor)&&X(t.dialect)}var $i=class{#e;constructor(e){this.#e=i(e)}async execute(e){return this.#e.executor.provideConnection(async r=>{let o=this.#e.executor.withConnectionProvider(new $r(r)),n=new Kt({...this.#e,executor:o});return await e(n)})}};p($i,"don't await ConnectionBuilder instances directly. To execute the query you need to call the `execute` method");var Ji=class t{#e;constructor(e){this.#e=i(e)}setIsolationLevel(e){return new t({...this.#e,isolationLevel:e})}async execute(e){let{isolationLevel:r,...o}=this.#e,n={isolationLevel:r};return _a(n),this.#e.executor.provideConnection(async s=>{let a=this.#e.executor.withConnectionProvider(new $r(s)),u=new Zo({...o,executor:a});try{await this.#e.driver.beginTransaction(s,n);let d=await e(u);return await this.#e.driver.commitTransaction(s),d}catch(d){throw await this.#e.driver.rollbackTransaction(s),d}})}};p(Ji,"don't await TransactionBuilder instances directly. To execute the transaction you need to call the `execute` method");function _a(t){if(t.isolationLevel&&!Ns.includes(t.isolationLevel))throw new Error(`invalid transaction isolation level ${t.isolationLevel}`)}var ji=class t{#e;constructor(e){this.#e=i(e)}get expressionType(){}get isRawBuilder(){return!0}as(e){return new Ki(this,e)}$castTo(){return new t({...this.#e})}$notNull(){return new t(this.#e)}withPlugin(e){return new t({...this.#e,plugins:this.#e.plugins!==void 0?i([...this.#e.plugins,e]):i([e])})}toOperationNode(){return this.#r(this.#t())}compile(e){return this.#i(this.#t(e))}async execute(e){let r=this.#t(e);return r.executeQuery(this.#i(r),this.#e.queryId)}#t(e){let r=e!==void 0?e.getExecutor():Ze;return this.#e.plugins!==void 0?r.withPlugins(this.#e.plugins):r}#r(e){return e.transformQuery(this.#e.rawNode,this.#e.queryId)}#i(e){return e.compileQuery(this.#r(e),this.#e.queryId)}};function Ve(t){return new ji(t)}p(ji,"don't await RawBuilder instances directly. To execute the query you need to call `execute`");var Ki=class{#e;#t;constructor(e,r){this.#e=e,this.#t=r}get expression(){return this.#e}get alias(){return this.#t}get rawBuilder(){return this.#e}toOperationNode(){return H.create(this.#e.toOperationNode(),D(this.#t)?this.#t.toOperationNode():N.create(this.#t))}};p(Ki,"don't await AliasedRawBuilder instances directly. AliasedRawBuilder should never be executed directly since it's always a part of another query.");var Jr=Object.assign((t,...e)=>Ve({queryId:T(),rawNode:R.create(t,e?.map(ws)??[])}),{ref(t){return Ve({queryId:T(),rawNode:R.createWithChild(ue(t))})},val(t){return Ve({queryId:T(),rawNode:R.createWithChild(v(t))})},value(t){return this.val(t)},table(t){return Ve({queryId:T(),rawNode:R.createWithChild(I(t))})},id(...t){let e=new Array(t.length+1).fill(".");return e[0]="",e[e.length-1]="",Ve({queryId:T(),rawNode:R.create(e,t.map(N.create))})},lit(t){return Ve({queryId:T(),rawNode:R.createWithChild($.createImmediate(t))})},literal(t){return this.lit(t)},raw(t){return Ve({queryId:T(),rawNode:R.createWithSql(t)})},join(t,e=Jr`, `){let r=new Array(2*t.length-1),o=e.toOperationNode();for(let n=0;n<t.length;++n)r[2*n]=ws(t[n]),n!==t.length-1&&(r[2*n+1]=o);return Ve({queryId:T(),rawNode:R.createWithChildren(r)})}});function ws(t){return D(t)?t.toOperationNode():v(t)}var Gi=class{nodeStack=[];get parentNode(){return this.nodeStack[this.nodeStack.length-2]}#e=i({AliasNode:this.visitAlias.bind(this),ColumnNode:this.visitColumn.bind(this),IdentifierNode:this.visitIdentifier.bind(this),SchemableIdentifierNode:this.visitSchemableIdentifier.bind(this),RawNode:this.visitRaw.bind(this),ReferenceNode:this.visitReference.bind(this),SelectQueryNode:this.visitSelectQuery.bind(this),SelectionNode:this.visitSelection.bind(this),TableNode:this.visitTable.bind(this),FromNode:this.visitFrom.bind(this),SelectAllNode:this.visitSelectAll.bind(this),AndNode:this.visitAnd.bind(this),OrNode:this.visitOr.bind(this),ValueNode:this.visitValue.bind(this),ValueListNode:this.visitValueList.bind(this),PrimitiveValueListNode:this.visitPrimitiveValueList.bind(this),ParensNode:this.visitParens.bind(this),JoinNode:this.visitJoin.bind(this),OperatorNode:this.visitOperator.bind(this),WhereNode:this.visitWhere.bind(this),InsertQueryNode:this.visitInsertQuery.bind(this),DeleteQueryNode:this.visitDeleteQuery.bind(this),ReturningNode:this.visitReturning.bind(this),CreateTableNode:this.visitCreateTable.bind(this),AddColumnNode:this.visitAddColumn.bind(this),ColumnDefinitionNode:this.visitColumnDefinition.bind(this),DropTableNode:this.visitDropTable.bind(this),DataTypeNode:this.visitDataType.bind(this),OrderByNode:this.visitOrderBy.bind(this),OrderByItemNode:this.visitOrderByItem.bind(this),GroupByNode:this.visitGroupBy.bind(this),GroupByItemNode:this.visitGroupByItem.bind(this),UpdateQueryNode:this.visitUpdateQuery.bind(this),ColumnUpdateNode:this.visitColumnUpdate.bind(this),LimitNode:this.visitLimit.bind(this),OffsetNode:this.visitOffset.bind(this),OnConflictNode:this.visitOnConflict.bind(this),OnDuplicateKeyNode:this.visitOnDuplicateKey.bind(this),CreateIndexNode:this.visitCreateIndex.bind(this),DropIndexNode:this.visitDropIndex.bind(this),ListNode:this.visitList.bind(this),PrimaryKeyConstraintNode:this.visitPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.visitUniqueConstraint.bind(this),ReferencesNode:this.visitReferences.bind(this),CheckConstraintNode:this.visitCheckConstraint.bind(this),WithNode:this.visitWith.bind(this),CommonTableExpressionNode:this.visitCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.visitCommonTableExpressionName.bind(this),HavingNode:this.visitHaving.bind(this),CreateSchemaNode:this.visitCreateSchema.bind(this),DropSchemaNode:this.visitDropSchema.bind(this),AlterTableNode:this.visitAlterTable.bind(this),DropColumnNode:this.visitDropColumn.bind(this),RenameColumnNode:this.visitRenameColumn.bind(this),AlterColumnNode:this.visitAlterColumn.bind(this),ModifyColumnNode:this.visitModifyColumn.bind(this),AddConstraintNode:this.visitAddConstraint.bind(this),DropConstraintNode:this.visitDropConstraint.bind(this),ForeignKeyConstraintNode:this.visitForeignKeyConstraint.bind(this),CreateViewNode:this.visitCreateView.bind(this),DropViewNode:this.visitDropView.bind(this),GeneratedNode:this.visitGenerated.bind(this),DefaultValueNode:this.visitDefaultValue.bind(this),OnNode:this.visitOn.bind(this),ValuesNode:this.visitValues.bind(this),SelectModifierNode:this.visitSelectModifier.bind(this),CreateTypeNode:this.visitCreateType.bind(this),DropTypeNode:this.visitDropType.bind(this),ExplainNode:this.visitExplain.bind(this),DefaultInsertValueNode:this.visitDefaultInsertValue.bind(this),AggregateFunctionNode:this.visitAggregateFunction.bind(this),OverNode:this.visitOver.bind(this),PartitionByNode:this.visitPartitionBy.bind(this),PartitionByItemNode:this.visitPartitionByItem.bind(this),SetOperationNode:this.visitSetOperation.bind(this),BinaryOperationNode:this.visitBinaryOperation.bind(this),UnaryOperationNode:this.visitUnaryOperation.bind(this),UsingNode:this.visitUsing.bind(this),FunctionNode:this.visitFunction.bind(this),CaseNode:this.visitCase.bind(this),WhenNode:this.visitWhen.bind(this),JSONReferenceNode:this.visitJSONReference.bind(this),JSONPathNode:this.visitJSONPath.bind(this),JSONPathLegNode:this.visitJSONPathLeg.bind(this),JSONOperatorChainNode:this.visitJSONOperatorChain.bind(this),TupleNode:this.visitTuple.bind(this),MergeQueryNode:this.visitMergeQuery.bind(this),MatchedNode:this.visitMatched.bind(this),AddIndexNode:this.visitAddIndex.bind(this),CastNode:this.visitCast.bind(this),FetchNode:this.visitFetch.bind(this),TopNode:this.visitTop.bind(this),OutputNode:this.visitOutput.bind(this)});visitNode=e=>{this.nodeStack.push(e),this.#e[e.kind](e),this.nodeStack.pop()}};var Xi=class extends Gi{#e="";#t=[];get numParameters(){return this.#t.length}compileQuery(e){return this.#e="",this.#t=[],this.nodeStack.splice(0,this.nodeStack.length),this.visitNode(e),i({query:e,sql:this.getSql(),parameters:[...this.#t]})}getSql(){return this.#e}visitSelectQuery(e){let r=this.parentNode!==void 0&&!Ce.is(this.parentNode)&&!z.is(this.parentNode)&&!Y.is(this.parentNode)&&!xe.is(this.parentNode)&&!Ci.is(this.parentNode);this.parentNode===void 0&&e.explain&&(this.visitNode(e.explain),this.append(" ")),r&&this.append("("),e.with&&(this.visitNode(e.with),this.append(" ")),this.append("select"),e.distinctOn&&(this.append(" "),this.compileDistinctOn(e.distinctOn)),e.frontModifiers?.length&&(this.append(" "),this.compileList(e.frontModifiers," ")),e.top&&(this.append(" "),this.visitNode(e.top)),e.selections&&(this.append(" "),this.compileList(e.selections)),e.from&&(this.append(" "),this.visitNode(e.from)),e.joins&&(this.append(" "),this.compileList(e.joins," ")),e.where&&(this.append(" "),this.visitNode(e.where)),e.groupBy&&(this.append(" "),this.visitNode(e.groupBy)),e.having&&(this.append(" "),this.visitNode(e.having)),e.setOperations&&(this.append(" "),this.compileList(e.setOperations," ")),e.orderBy&&(this.append(" "),this.visitNode(e.orderBy)),e.limit&&(this.append(" "),this.visitNode(e.limit)),e.offset&&(this.append(" "),this.visitNode(e.offset)),e.fetch&&(this.append(" "),this.visitNode(e.fetch)),e.endModifiers?.length&&(this.append(" "),this.compileList(this.sortSelectModifiers([...e.endModifiers])," ")),r&&this.append(")")}visitFrom(e){this.append("from "),this.compileList(e.froms)}visitSelection(e){this.visitNode(e.selection)}visitColumn(e){this.visitNode(e.column)}compileDistinctOn(e){this.append("distinct on ("),this.compileList(e),this.append(")")}compileList(e,r=", "){let o=e.length-1;for(let n=0;n<=o;n++)this.visitNode(e[n]),n<o&&this.append(r)}visitWhere(e){this.append("where "),this.visitNode(e.where)}visitHaving(e){this.append("having "),this.visitNode(e.having)}visitInsertQuery(e){let r=this.nodeStack.find(l.is),o=r!==e;!o&&e.explain&&(this.visitNode(e.explain),this.append(" ")),o&&!Q.is(r)&&this.append("("),e.with&&(this.visitNode(e.with),this.append(" ")),this.append(e.replace?"replace":"insert"),e.ignore&&this.append(" ignore"),e.top&&(this.append(" "),this.visitNode(e.top)),e.into&&(this.append(" into "),this.visitNode(e.into)),e.columns&&(this.append(" ("),this.compileList(e.columns),this.append(")")),e.output&&(this.append(" "),this.visitNode(e.output)),e.values&&(this.append(" "),this.visitNode(e.values)),e.defaultValues&&(this.append(" "),this.append("default values")),e.onConflict&&(this.append(" "),this.visitNode(e.onConflict)),e.onDuplicateKey&&(this.append(" "),this.visitNode(e.onDuplicateKey)),e.returning&&(this.append(" "),this.visitNode(e.returning)),o&&!Q.is(r)&&this.append(")")}visitValues(e){this.append("values "),this.compileList(e.values)}visitDeleteQuery(e){let r=this.nodeStack.find(l.is)!==e;!r&&e.explain&&(this.visitNode(e.explain),this.append(" ")),r&&this.append("("),e.with&&(this.visitNode(e.with),this.append(" ")),this.append("delete "),e.top&&(this.visitNode(e.top),this.append(" ")),this.visitNode(e.from),e.output&&(this.append(" "),this.visitNode(e.output)),e.using&&(this.append(" "),this.visitNode(e.using)),e.joins&&(this.append(" "),this.compileList(e.joins," ")),e.where&&(this.append(" "),this.visitNode(e.where)),e.orderBy&&(this.append(" "),this.visitNode(e.orderBy)),e.limit&&(this.append(" "),this.visitNode(e.limit)),e.returning&&(this.append(" "),this.visitNode(e.returning)),r&&this.append(")")}visitReturning(e){this.append("returning "),this.compileList(e.selections)}visitAlias(e){this.visitNode(e.node),this.append(" as "),this.visitNode(e.alias)}visitReference(e){e.table&&(this.visitNode(e.table),this.append(".")),this.visitNode(e.column)}visitSelectAll(e){this.append("*")}visitIdentifier(e){this.append(this.getLeftIdentifierWrapper()),this.compileUnwrappedIdentifier(e),this.append(this.getRightIdentifierWrapper())}compileUnwrappedIdentifier(e){if(!L(e.name))throw new Error("a non-string identifier was passed to compileUnwrappedIdentifier.");this.append(this.sanitizeIdentifier(e.name))}visitAnd(e){this.visitNode(e.left),this.append(" and "),this.visitNode(e.right)}visitOr(e){this.visitNode(e.left),this.append(" or "),this.visitNode(e.right)}visitValue(e){e.immediate?this.appendImmediateValue(e.value):this.appendValue(e.value)}visitValueList(e){this.append("("),this.compileList(e.values),this.append(")")}visitTuple(e){this.append("("),this.compileList(e.values),this.append(")")}visitPrimitiveValueList(e){this.append("(");let{values:r}=e;for(let o=0;o<r.length;++o)this.appendValue(r[o]),o!==r.length-1&&this.append(", ");this.append(")")}visitParens(e){this.append("("),this.visitNode(e.node),this.append(")")}visitJoin(e){this.append(Ha[e.joinType]),this.append(" "),this.visitNode(e.table),e.on&&(this.append(" "),this.visitNode(e.on))}visitOn(e){this.append("on "),this.visitNode(e.on)}visitRaw(e){let{sqlFragments:r,parameters:o}=e;for(let n=0;n<r.length;++n)this.append(r[n]),o.length>n&&this.visitNode(o[n])}visitOperator(e){this.append(e.operator)}visitTable(e){this.visitNode(e.table)}visitSchemableIdentifier(e){e.schema&&(this.visitNode(e.schema),this.append(".")),this.visitNode(e.identifier)}visitCreateTable(e){this.append("create "),e.frontModifiers&&e.frontModifiers.length>0&&(this.compileList(e.frontModifiers," "),this.append(" ")),e.temporary&&this.append("temporary "),this.append("table "),e.ifNotExists&&this.append("if not exists "),this.visitNode(e.table),e.selectQuery?(this.append(" as "),this.visitNode(e.selectQuery)):(this.append(" ("),this.compileList([...e.columns,...e.constraints??[]]),this.append(")"),e.onCommit&&(this.append(" on commit "),this.append(e.onCommit)),e.endModifiers&&e.endModifiers.length>0&&(this.append(" "),this.compileList(e.endModifiers," ")))}visitColumnDefinition(e){e.ifNotExists&&this.append("if not exists "),this.visitNode(e.column),this.append(" "),this.visitNode(e.dataType),e.unsigned&&this.append(" unsigned"),e.frontModifiers&&e.frontModifiers.length>0&&(this.append(" "),this.compileList(e.frontModifiers," ")),e.generated&&(this.append(" "),this.visitNode(e.generated)),e.identity&&this.append(" identity"),e.defaultTo&&(this.append(" "),this.visitNode(e.defaultTo)),e.notNull&&this.append(" not null"),e.unique&&this.append(" unique"),e.nullsNotDistinct&&this.append(" nulls not distinct"),e.primaryKey&&this.append(" primary key"),e.autoIncrement&&(this.append(" "),this.append(this.getAutoIncrement())),e.references&&(this.append(" "),this.visitNode(e.references)),e.check&&(this.append(" "),this.visitNode(e.check)),e.endModifiers&&e.endModifiers.length>0&&(this.append(" "),this.compileList(e.endModifiers," "))}getAutoIncrement(){return"auto_increment"}visitReferences(e){this.append("references "),this.visitNode(e.table),this.append(" ("),this.compileList(e.columns),this.append(")"),e.onDelete&&(this.append(" on delete "),this.append(e.onDelete)),e.onUpdate&&(this.append(" on update "),this.append(e.onUpdate))}visitDropTable(e){this.append("drop table "),e.ifExists&&this.append("if exists "),this.visitNode(e.table),e.cascade&&this.append(" cascade")}visitDataType(e){this.append(e.dataType)}visitOrderBy(e){this.append("order by "),this.compileList(e.items)}visitOrderByItem(e){this.visitNode(e.orderBy),e.direction&&(this.append(" "),this.visitNode(e.direction))}visitGroupBy(e){this.append("group by "),this.compileList(e.items)}visitGroupByItem(e){this.visitNode(e.groupBy)}visitUpdateQuery(e){let r=this.nodeStack.find(l.is),o=r!==e;!o&&e.explain&&(this.visitNode(e.explain),this.append(" ")),o&&!Q.is(r)&&this.append("("),e.with&&(this.visitNode(e.with),this.append(" ")),this.append("update "),e.top&&(this.visitNode(e.top),this.append(" ")),e.table&&(this.visitNode(e.table),this.append(" ")),this.append("set "),e.updates&&this.compileList(e.updates),e.output&&(this.append(" "),this.visitNode(e.output)),e.from&&(this.append(" "),this.visitNode(e.from)),e.joins&&(this.append(" "),this.compileList(e.joins," ")),e.where&&(this.append(" "),this.visitNode(e.where)),e.limit&&(this.append(" "),this.visitNode(e.limit)),e.returning&&(this.append(" "),this.visitNode(e.returning)),o&&!Q.is(r)&&this.append(")")}visitColumnUpdate(e){this.visitNode(e.column),this.append(" = "),this.visitNode(e.value)}visitLimit(e){this.append("limit "),this.visitNode(e.limit)}visitOffset(e){this.append("offset "),this.visitNode(e.offset)}visitOnConflict(e){this.append("on conflict"),e.columns?(this.append(" ("),this.compileList(e.columns),this.append(")")):e.constraint?(this.append(" on constraint "),this.visitNode(e.constraint)):e.indexExpression&&(this.append(" ("),this.visitNode(e.indexExpression),this.append(")")),e.indexWhere&&(this.append(" "),this.visitNode(e.indexWhere)),e.doNothing===!0?this.append(" do nothing"):e.updates&&(this.append(" do update set "),this.compileList(e.updates),e.updateWhere&&(this.append(" "),this.visitNode(e.updateWhere)))}visitOnDuplicateKey(e){this.append("on duplicate key update "),this.compileList(e.updates)}visitCreateIndex(e){this.append("create "),e.unique&&this.append("unique "),this.append("index "),e.ifNotExists&&this.append("if not exists "),this.visitNode(e.name),e.table&&(this.append(" on "),this.visitNode(e.table)),e.using&&(this.append(" using "),this.visitNode(e.using)),e.columns&&(this.append(" ("),this.compileList(e.columns),this.append(")")),e.nullsNotDistinct&&this.append(" nulls not distinct"),e.where&&(this.append(" "),this.visitNode(e.where))}visitDropIndex(e){this.append("drop index "),e.ifExists&&this.append("if exists "),this.visitNode(e.name),e.table&&(this.append(" on "),this.visitNode(e.table)),e.cascade&&this.append(" cascade")}visitCreateSchema(e){this.append("create schema "),e.ifNotExists&&this.append("if not exists "),this.visitNode(e.schema)}visitDropSchema(e){this.append("drop schema "),e.ifExists&&this.append("if exists "),this.visitNode(e.schema),e.cascade&&this.append(" cascade")}visitPrimaryKeyConstraint(e){e.name&&(this.append("constraint "),this.visitNode(e.name),this.append(" ")),this.append("primary key ("),this.compileList(e.columns),this.append(")")}visitUniqueConstraint(e){e.name&&(this.append("constraint "),this.visitNode(e.name),this.append(" ")),this.append("unique"),e.nullsNotDistinct&&this.append(" nulls not distinct"),this.append(" ("),this.compileList(e.columns),this.append(")")}visitCheckConstraint(e){e.name&&(this.append("constraint "),this.visitNode(e.name),this.append(" ")),this.append("check ("),this.visitNode(e.expression),this.append(")")}visitForeignKeyConstraint(e){e.name&&(this.append("constraint "),this.visitNode(e.name),this.append(" ")),this.append("foreign key ("),this.compileList(e.columns),this.append(") "),this.visitNode(e.references),e.onDelete&&(this.append(" on delete "),this.append(e.onDelete)),e.onUpdate&&(this.append(" on update "),this.append(e.onUpdate))}visitList(e){this.compileList(e.items)}visitWith(e){this.append("with "),e.recursive&&this.append("recursive "),this.compileList(e.expressions)}visitCommonTableExpression(e){this.visitNode(e.name),this.append(" as "),ut(e.materialized)&&(e.materialized||this.append("not "),this.append("materialized ")),this.visitNode(e.expression)}visitCommonTableExpressionName(e){this.visitNode(e.table),e.columns&&(this.append("("),this.compileList(e.columns),this.append(")"))}visitAlterTable(e){this.append("alter table "),this.visitNode(e.table),this.append(" "),e.renameTo&&(this.append("rename to "),this.visitNode(e.renameTo)),e.setSchema&&(this.append("set schema "),this.visitNode(e.setSchema)),e.addConstraint&&this.visitNode(e.addConstraint),e.dropConstraint&&this.visitNode(e.dropConstraint),e.columnAlterations&&this.compileColumnAlterations(e.columnAlterations),e.addIndex&&this.visitNode(e.addIndex),e.dropIndex&&this.visitNode(e.dropIndex)}visitAddColumn(e){this.append("add column "),this.visitNode(e.column)}visitRenameColumn(e){this.append("rename column "),this.visitNode(e.column),this.append(" to "),this.visitNode(e.renameTo)}visitDropColumn(e){this.append("drop column "),this.visitNode(e.column)}visitAlterColumn(e){this.append("alter column "),this.visitNode(e.column),this.append(" "),e.dataType&&(this.announcesNewColumnDataType()&&this.append("type "),this.visitNode(e.dataType),e.dataTypeExpression&&(this.append("using "),this.visitNode(e.dataTypeExpression))),e.setDefault&&(this.append("set default "),this.visitNode(e.setDefault)),e.dropDefault&&this.append("drop default"),e.setNotNull&&this.append("set not null"),e.dropNotNull&&this.append("drop not null")}visitModifyColumn(e){this.append("modify column "),this.visitNode(e.column)}visitAddConstraint(e){this.append("add "),this.visitNode(e.constraint)}visitDropConstraint(e){this.append("drop constraint "),e.ifExists&&this.append("if exists "),this.visitNode(e.constraintName),e.modifier==="cascade"?this.append(" cascade"):e.modifier==="restrict"&&this.append(" restrict")}visitSetOperation(e){this.append(e.operator),this.append(" "),e.all&&this.append("all "),this.visitNode(e.expression)}visitCreateView(e){this.append("create "),e.orReplace&&this.append("or replace "),e.materialized&&this.append("materialized "),e.temporary&&this.append("temporary "),this.append("view "),e.ifNotExists&&this.append("if not exists "),this.visitNode(e.name),this.append(" "),e.columns&&(this.append("("),this.compileList(e.columns),this.append(") ")),e.as&&(this.append("as "),this.visitNode(e.as))}visitDropView(e){this.append("drop "),e.materialized&&this.append("materialized "),this.append("view "),e.ifExists&&this.append("if exists "),this.visitNode(e.name),e.cascade&&this.append(" cascade")}visitGenerated(e){this.append("generated "),e.always&&this.append("always "),e.byDefault&&this.append("by default "),this.append("as "),e.identity&&this.append("identity"),e.expression&&(this.append("("),this.visitNode(e.expression),this.append(")")),e.stored&&this.append(" stored")}visitDefaultValue(e){this.append("default "),this.visitNode(e.defaultValue)}visitSelectModifier(e){e.rawModifier?this.visitNode(e.rawModifier):this.append(Ya[e.modifier]),e.of&&(this.append(" of "),this.compileList(e.of,", "))}visitCreateType(e){this.append("create type "),this.visitNode(e.name),e.enum&&(this.append(" as enum "),this.visitNode(e.enum))}visitDropType(e){this.append("drop type "),e.ifExists&&this.append("if exists "),this.visitNode(e.name)}visitExplain(e){this.append("explain"),(e.options||e.format)&&(this.append(" "),this.append(this.getLeftExplainOptionsWrapper()),e.options&&(this.visitNode(e.options),e.format&&this.append(this.getExplainOptionsDelimiter())),e.format&&(this.append("format"),this.append(this.getExplainOptionAssignment()),this.append(e.format)),this.append(this.getRightExplainOptionsWrapper()))}visitDefaultInsertValue(e){this.append("default")}visitAggregateFunction(e){this.append(e.func),this.append("("),e.distinct&&this.append("distinct "),this.compileList(e.aggregated),this.append(")"),e.filter&&(this.append(" filter("),this.visitNode(e.filter),this.append(")")),e.over&&(this.append(" "),this.visitNode(e.over))}visitOver(e){this.append("over("),e.partitionBy&&(this.visitNode(e.partitionBy),e.orderBy&&this.append(" ")),e.orderBy&&this.visitNode(e.orderBy),this.append(")")}visitPartitionBy(e){this.append("partition by "),this.compileList(e.items)}visitPartitionByItem(e){this.visitNode(e.partitionBy)}visitBinaryOperation(e){this.visitNode(e.leftOperand),this.append(" "),this.visitNode(e.operator),this.append(" "),this.visitNode(e.rightOperand)}visitUnaryOperation(e){this.visitNode(e.operator),this.isMinusOperator(e.operator)||this.append(" "),this.visitNode(e.operand)}isMinusOperator(e){return ae.is(e)&&e.operator==="-"}visitUsing(e){this.append("using "),this.compileList(e.tables)}visitFunction(e){this.append(e.func),this.append("("),this.compileList(e.arguments),this.append(")")}visitCase(e){this.append("case"),e.value&&(this.append(" "),this.visitNode(e.value)),e.when&&(this.append(" "),this.compileList(e.when," ")),e.else&&(this.append(" else "),this.visitNode(e.else)),this.append(" end"),e.isStatement&&this.append(" case")}visitWhen(e){this.append("when "),this.visitNode(e.condition),e.result&&(this.append(" then "),this.visitNode(e.result))}visitJSONReference(e){this.visitNode(e.reference),this.visitNode(e.traversal)}visitJSONPath(e){e.inOperator&&this.visitNode(e.inOperator),this.append("'$");for(let r of e.pathLegs)this.visitNode(r);this.append("'")}visitJSONPathLeg(e){let r=e.type==="ArrayLocation";this.append(r?"[":"."),this.append(String(e.value)),r&&this.append("]")}visitJSONOperatorChain(e){for(let r=0,o=e.values.length;r<o;r++)r===o-1?this.visitNode(e.operator):this.append("->"),this.visitNode(e.values[r])}visitMergeQuery(e){e.with&&(this.visitNode(e.with),this.append(" ")),this.append("merge "),e.top&&(this.visitNode(e.top),this.append(" ")),this.append("into "),this.visitNode(e.into),e.using&&(this.append(" "),this.visitNode(e.using)),e.whens&&(this.append(" "),this.compileList(e.whens," ")),e.output&&(this.append(" "),this.visitNode(e.output))}visitMatched(e){e.not&&this.append("not "),this.append("matched"),e.bySource&&this.append(" by source")}visitAddIndex(e){this.append("add "),e.unique&&this.append("unique "),this.append("index "),this.visitNode(e.name),e.columns&&(this.append(" ("),this.compileList(e.columns),this.append(")")),e.using&&(this.append(" using "),this.visitNode(e.using))}visitCast(e){this.append("cast("),this.visitNode(e.expression),this.append(" as "),this.visitNode(e.dataType),this.append(")")}visitFetch(e){this.append("fetch next "),this.visitNode(e.rowCount),this.append(` rows ${e.modifier}`)}visitOutput(e){this.append("output "),this.compileList(e.selections)}visitTop(e){this.append(`top(${e.expression})`),e.modifiers&&this.append(` ${e.modifiers}`)}append(e){this.#e+=e}appendValue(e){this.addParameter(e),this.append(this.getCurrentParameterPlaceholder())}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getCurrentParameterPlaceholder(){return"$"+this.numParameters}getLeftExplainOptionsWrapper(){return"("}getExplainOptionAssignment(){return" "}getExplainOptionsDelimiter(){return", "}getRightExplainOptionsWrapper(){return")"}sanitizeIdentifier(e){let r=this.getLeftIdentifierWrapper(),o=this.getRightIdentifierWrapper(),n="";for(let s of e)n+=s,s===r?n+=r:s===o&&(n+=o);return n}addParameter(e){this.#t.push(e)}appendImmediateValue(e){if(L(e))this.append(`'${e}'`);else if(je(e)||ut(e))this.append(e.toString());else if(bt(e))this.append("null");else if(Tn(e))this.appendImmediateValue(e.toISOString());else if(Ot(e))this.appendImmediateValue(e.toString());else throw new Error(`invalid immediate value ${e}`)}sortSelectModifiers(e){return e.sort((r,o)=>r.modifier&&o.modifier?xs[r.modifier]-xs[o.modifier]:1),i(e)}compileColumnAlterations(e){this.compileList(e)}announcesNewColumnDataType(){return!0}},Ya=i({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked",Distinct:"distinct"}),xs=i({ForKeyShare:1,ForNoKeyUpdate:1,ForUpdate:1,ForShare:1,NoWait:2,SkipLocked:2,Distinct:0}),Ha=i({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral",Using:"using"});var _i=i({raw(t,e=[]){return i({sql:t,query:R.createWithSql(t),parameters:i(e)})}});var Yi=class{get supportsCreateIfNotExists(){return!0}get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}get supportsOutput(){return!1}};var Hi=class{#e;#t=new tn;#r;#i;constructor(e){this.#e=i({...e})}async init(){this.#r=q(this.#e.database)?await this.#e.database():this.#e.database,this.#i=new en(this.#r),this.#e.onCreateConnection&&await this.#e.onCreateConnection(this.#i)}async acquireConnection(){return await this.#t.lock(),this.#i}async beginTransaction(e){await e.executeQuery(_i.raw("begin"))}async commitTransaction(e){await e.executeQuery(_i.raw("commit"))}async rollbackTransaction(e){await e.executeQuery(_i.raw("rollback"))}async releaseConnection(){this.#t.unlock()}async destroy(){this.#r?.close()}},en=class{#e;constructor(e){this.#e=e}executeQuery(e){let{sql:r,parameters:o}=e,n=this.#e.prepare(r);if(n.reader)return Promise.resolve({rows:n.all(o)});{let{changes:s,lastInsertRowid:a}=n.run(o),u=s!=null?BigInt(s):void 0;return Promise.resolve({numUpdatedOrDeletedRows:u,numAffectedRows:u,insertId:a!=null?BigInt(a):void 0,rows:[]})}}async*streamQuery(e,r){let{sql:o,parameters:n,query:s}=e,a=this.#e.prepare(o);if(w.is(s)){let u=a.iterate(n);for(let d of u)yield{rows:[d]}}else throw new Error("Sqlite driver only supports streaming of select queries")}},tn=class{#e;#t;async lock(){for(;this.#e;)await this.#e;this.#e=new Promise(e=>{this.#t=e})}unlock(){let e=this.#t;this.#e=void 0,this.#t=void 0,e?.()}};var Za=/"/g,Zi=class extends Xi{getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getAutoIncrement(){return"autoincrement"}sanitizeIdentifier(e){return e.replace(Za,'""')}visitDefaultInsertValue(e){this.append("null")}};var gs="kysely_migration",bs="kysely_migration_lock";var $I=i({__noMigrations__:!0});var eo=class{#e;constructor(e){this.#e=e}async getSchemas(){return[]}async getTables(e={withInternalKyselyTables:!1}){let r=this.#e.selectFrom("sqlite_master").where("type","in",["table","view"]).where("name","not like","sqlite_%").select("name").orderBy("name").$castTo();e.withInternalKyselyTables||(r=r.where("name","!=",gs).where("name","!=",bs));let o=await r.execute();return Promise.all(o.map(({name:n})=>this.#t(n)))}async getMetadata(e){return{tables:await this.getTables(e)}}async#t(e){let r=this.#e,o=await r.selectFrom("sqlite_master").where("name","=",e).select(["sql","type"]).$castTo().executeTakeFirstOrThrow(),n=o.sql?.split(/[\(\),]/)?.find(a=>a.toLowerCase().includes("autoincrement"))?.trimStart()?.split(/\s+/)?.[0]?.replace(/["`]/g,""),s=await r.selectFrom(Jr`pragma_table_info(${e})`.as("table_info")).select(["name","type","notnull","dflt_value"]).orderBy("cid").execute();return{name:e,isView:o.type==="view",columns:s.map(a=>({name:a.name,dataType:a.type,isNullable:!a.notnull,isAutoIncrementing:a.name===n,hasDefaultValue:a.dflt_value!=null,comment:void 0}))}}};var to=class extends Yi{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!0}async acquireMigrationLock(e,r){}async releaseMigrationLock(e,r){}};var ro=class{#e;constructor(e){this.#e=i({...e})}createDriver(){return new Hi(this.#e)}createQueryCompiler(){return new Zi}createAdapter(){return new to}createIntrospector(e){return new eo(e)}};var io=class extends He{#e;constructor(e){super(),this.#e=e}transformIdentifier(e){return e=super.transformIdentifier(e),{...e,name:this.#e(e.name)}}};function Es({upperCase:t=!1,underscoreBeforeDigits:e=!1,underscoreBetweenUppercaseLetters:r=!1}={}){return Is(o=>{if(o.length===0)return o;let n=o.toUpperCase(),s=o.toLowerCase(),a=s[0];for(let u=1,d=o.length;u<d;++u){let c=o[u],y=o[u-1],f=n[u],h=n[u-1],x=s[u],F=s[u-1];if(e&&Os(c)&&!Os(y)){a+="_"+c;continue}c===f&&f!==x?r||!(y===h&&h!==F)?a+="_"+x:a+=x:a+=c}return t?a.toUpperCase():a})}function Ts({upperCase:t=!1}={}){return Is(e=>{if(e.length===0)return e;t&&eu(e)&&(e=e.toLowerCase());let r=e[0];for(let o=1,n=e.length;o<n;++o){let s=e[o],a=e[o-1];s!=="_"&&(a==="_"?r+=s.toUpperCase():r+=s)}return r})}function eu(t){for(let e=1,r=t.length;e<r;++e){let o=t[e];if(o!=="_"&&o!==o.toUpperCase())return!1}return!0}function Os(t){return t>="0"&&t<="9"}function Is(t){let e=new Map;return r=>{let o=e.get(r);return o||(o=t(r),e.set(r,o)),o}}var oo=class{opt;#e;#t;#r;constructor(e={}){this.opt=e,this.#e=Ts(e),this.#t=Es(e),this.#r=new io(this.snakeCase.bind(this))}transformQuery(e){return this.#r.transformNode(e.node)}async transformResult(e){return e.result.rows&&Array.isArray(e.result.rows)?{...e.result,rows:e.result.rows.map(r=>this.mapRow(r))}:e.result}mapRow(e){return Object.keys(e).reduce((r,o)=>{let n=e[o];return Array.isArray(n)?n=n.map(s=>Cs(s,this.opt)?this.mapRow(s):s):Cs(n,this.opt)&&(n=this.mapRow(n)),r[this.camelCase(o)]=n,r},{})}snakeCase(e){return this.#t(e)}camelCase(e){return this.#e(e)}};function Cs(t,e){return In(t)&&!e?.maintainNestedObjectKeys}var jr=class{async establishDatabaseConnection(e){return await Jr`SELECT 1;`.execute(e)}async connect(e){for(let r of[!0,!1])try{let o=await e.dialect.createKyselyDialect({connectionString:e.connectionString,ssl:r}),n=new Kt({dialect:o});return await this.establishDatabaseConnection(n),n}catch(o){let n=o instanceof Error&&/\bSSL\b/.test(o.message);if(!r||!n)throw o}throw new Error("Failed to connect to database.")}async getTables(e){return await e.db.introspection.getTables()}};var no=class extends jr{async introspect(e){let r=await this.getTables(e),o=new Kr;return new Gr(r,o)}};var _r=class extends cr{constructor(){super(...arguments);this.adapter=new pr;this.introspector=new no}async createKyselyDialect(r){let{default:o}=await Promise.resolve().then(()=>xn(sa()));return new ro({database:new o(r.connectionString)})}};var Yr=class{getDialect(e){switch(e){case"sqlite":return new _r;default:throw new Error("Unsupported dialect")}}};var Kr=class{constructor(e={}){this.enums={};this.enums=e}add(e,r){(this.enums[e]??=[]).push(r)}get(e){return this.enums[e]?.sort((r,o)=>r.localeCompare(o))??null}has(e){return!!this.enums[e]}set(e,r){this.enums[e]=r}};var Hr=(s=>(s[s.SILENT=0]="SILENT",s[s.INFO=1]="INFO",s[s.WARN=2]="WARN",s[s.ERROR=3]="ERROR",s[s.DEBUG=4]="DEBUG",s))(Hr||{});var aa=require("util");var Xt=class{constructor(e=1){this.logLevel=e}#e(e){return e.map(r=>r instanceof Object?(0,aa.inspect)(r,{colors:!0}):r).join(" ")}debug(...e){if(this.logLevel>=4)for(let r of e)console.debug(this.serializeDebug(r))}error(...e){if(this.logLevel>=3)for(let r of e)console.error(this.serializeError(r))}info(...e){if(this.logLevel>=1)for(let r of e)console.info(this.serializeInfo(r))}log(...e){if(this.logLevel>=1)for(let r of e)console.log(r)}serializeDebug(...e){return`  ${this.#e(e)}`}serializeError(...e){return`\u2717 ${this.#e(e)}`}serializeInfo(...e){return`\u2022 ${this.#e(e)}`}serializeSuccess(...e){return`\u2713 ${this.#e(e)}`}serializeWarn(...e){return`\u26A0 ${this.#e(e)}`}success(...e){if(this.logLevel>=1)for(let r of e)console.log(this.serializeSuccess(r))}warn(...e){if(this.logLevel>=2)for(let r of e)console.warn(this.serializeWarn(r))}};var Zr=class{constructor(e){this.comment=e.comment??null,this.dataType=e.dataType,this.dataTypeSchema=e.dataTypeSchema,this.enumValues=e.enumValues??null,this.hasDefaultValue=e.hasDefaultValue??!1,this.isArray=e.isArray??!1,this.isAutoIncrementing=e.isAutoIncrementing??!1,this.isNullable=e.isNullable??!1,this.name=e.name}};var ei=class{constructor(e){this.columns=e.columns.map(r=>new Zr(r)),this.name=e.name,this.schema=e.schema}};var Gr=class{constructor(e,r){this.enums=r,this.tables=e.map(o=>new ei(o))}};var hn=require("fs"),Yt=require("path"),fn=require("perf_hooks");var un=class extends oo{toCamelCase(e){return this.camelCase(e)}toSnakeCase(e){return this.snakeCase(e)}},_t=t=>new un().toCamelCase(t),dn=t=>{let e=_t(t);return e.slice(0,1).toUpperCase()+e.slice(1)};var cn={ArrayType:new at(["T"],new st(new G("ArrayTypeImpl",[new m("T")]),new ne(new le("U")),new ne(new m("U")),new G("ArrayTypeImpl",[new m("T")]))),ArrayTypeImpl:new at(["T"],new st(new m("T"),new G("ColumnType",[new le("S"),new le("I"),new le("U")]),new G("ColumnType",[new ne(new m("S")),new ne(new m("I")),new ne(new m("U"))]),new ne(new m("T")))),Generated:new at(["T"],new st(new m("T"),new G("ColumnType",[new le("S"),new le("I"),new le("U")]),new G("ColumnType",[new m("S"),new Ee([new m("I"),new m("undefined")]),new m("U")]),new G("ColumnType",[new m("T"),new Ee([new m("T"),new m("undefined")]),new m("T")])))},Au=new ne(new m("JsonValue")),Wu=new nr(new m("JsonValue")),qu=new Ee([new m("boolean"),new m("null"),new m("number"),new m("string")]),Du=new Ee([new m("JsonArray"),new m("JsonObject"),new m("JsonPrimitive")]),Ru=new m("JsonValue");var pn={ColumnType:new sr("kysely")};var ln=(n=>(n.DEFINITION="Definition",n.MODULE_REFERENCE="ModuleReference",n.RUNTIME_ENUM_DEFINITION="RuntimeEnumDefinition",n.TABLE="Table",n))(ln||{}),ti=class{constructor(e={},r={}){this.symbolNames=r,this.symbols=e}entries(){return Object.entries(this.symbols).map(([e,r])=>({id:e,name:this.symbolNames[e],symbol:r}))}get(e){return this.symbols[e]}getName(e){return this.symbolNames[e]}has(e){return this.symbols[e]!==void 0}set(e,r){let o=this.symbolNames[e];if(o)return o;let n=new Set(Object.values(this.symbolNames));if(o=dn(e.replaceAll(/[^\w$]/g,"_")),n.has(o)){let s=2;for(;n.has(`${o}${s}`);)s++;o+=s}return this.symbols[e]=r,this.symbolNames[e]=o,o}};var mn=t=>{switch(t.length){case 0:return new m("never");case 1:return t[0];default:return new Ee(t)}},ri=class{#e(e,r){let o=r.definitions[e];if(o){if(r.symbols.has(e))return;r.symbols.set(e,{node:o,type:"Definition"}),this.#t(o,r);return}let n=r.imports[e];if(n){if(r.symbols.has(e))return;r.symbols.set(e,{node:n,type:"ModuleReference"})}}#t(e,r){switch(e.type){case"ArrayExpression":this.#t(e.values,r);break;case"ExtendsClause":this.#t(e.extendsType,r),this.#t(e.trueType,r),this.#t(e.falseType,r);break;case"GenericExpression":{this.#e(e.name,r);for(let o of e.args)this.#t(o,r);break}case"Identifier":this.#e(e.name,r);break;case"InferClause":break;case"Literal":break;case"MappedType":this.#t(e.value,r);break;case"ObjectExpression":for(let o of e.properties)this.#t(o.value,r);break;case"Template":this.#t(e.expression,r);break;case"UnionExpression":for(let o of e.args)this.#t(o,r);break}}#r(e){return{camelCase:!!e.camelCase,defaultScalar:e.dialect.adapter.defaultScalar??new m("unknown"),defaultSchema:e.defaultSchema??e.dialect.adapter.defaultSchema,definitions:{...cn,...e.dialect.adapter.definitions},enums:e.metadata.enums,imports:{...pn,...e.dialect.adapter.imports},metadata:e.metadata,runtimeEnums:!!e.runtimeEnums,scalars:{...e.dialect.adapter.scalars},symbols:new ti}}#i(e){let r=[];for(let s of e.metadata.tables){let a=this.#s(s,e),u=e.symbols.getName(a);if(u){let d=new m(u),c=new gt(a,d);r.push(c)}}r.sort((s,a)=>s.key.localeCompare(a.key));let o=new xt(r),n=new wt("DB",o);return new Je(n)}#o(e){let r=[];for(let{name:o,symbol:n}of e.symbols.entries())if(n.type==="RuntimeEnumDefinition"){let s=new ar(o,n.node),a=new Je(s);r.push(a)}return r.sort((o,n)=>o.argument.name.localeCompare(n.argument.name))}#a(e){let r=[];for(let{name:o,symbol:n}of e.symbols.entries())if(n.type==="Definition"){let s=new tr(o,n.node),a=new Je(s);r.push(a)}return r.sort((o,n)=>o.argument.name.localeCompare(n.argument.name))}#n(e){let r={},o=[];for(let{id:n,name:s,symbol:a}of e.symbols.entries())a.type==="ModuleReference"&&(r[a.node.name]??=[]).push(new rr(n,s===n?null:s));for(let[n,s]of Object.entries(r))o.push(new ir(n,s));return o.sort((n,s)=>n.moduleName.localeCompare(s.moduleName))}#s(e,r){let o=e.schema&&r.defaultSchema&&e.schema!==r.defaultSchema?`${e.schema}.${e.name}`:e.name;return this.#p(o,r)}#u(e,r){let o=this.#c(e,r);if(e.isArray){let a=mn(o);o=a.type==="Identifier"&&["boolean","number","string"].includes(a.name)?[new ne(a)]:[new G("ArrayType",[a])]}e.isNullable&&o.push(new m("null"));let n=mn(o);return(e.hasDefaultValue||e.isAutoIncrementing)&&(n=new G("Generated",[n])),this.#t(n,r),n}#c(e,r){let o=e.dataType.toLowerCase(),n=r.scalars[o];if(n)return[n];let s=`${e.dataTypeSchema??r.defaultSchema}.${o}`,a=e.dataTypeSchema&&e.dataTypeSchema!==r.defaultSchema?`${e.dataTypeSchema}.${o}`:o,u=r.enums.get(s);if(u){let c=mn(this.#d(u)),y=r.symbols.set(a,{node:c,type:r.runtimeEnums?"RuntimeEnumDefinition":"Definition"});return[new m(y)]}let d=r.symbols.getName(a);return d?[new m(d??"unknown")]:e.enumValues?this.#d(e.enumValues):[r.defaultScalar]}#d(e){return e.map(r=>new or(r))}#p(e,r){return r.camelCase?_t(e):e}#l(e){let r=[];for(let o of e.metadata.tables){let n=[];for(let c of o.columns){let y=this.#p(c.name,e),f=this.#u(c,e),h=c.comment,x=new gt(y,f,h);n.push(x)}let s=new xt(n),a=this.#s(o,e),u=e.symbols.set(a,{type:"Table"}),d=new Je(new wt(u,s));r.push(d)}return r.sort((o,n)=>o.argument.name.localeCompare(n.argument.name)),r}transform(e){let r=this.#r(e),o=this.#l(r),n=this.#n(r),s=this.#o(r),a=this.#a(r),u=this.#i(r);return[...n,...s,...a,...o,u]}};var ku=/^[$A-Z_a-z][\w$]*$/,ii=class{constructor(e={}){this.camelCase=e.camelCase??!1,this.typeOnlyImports=e.typeOnlyImports??!0}serialize(e){let r="",o=0;for(let n of e){switch(o>=1&&(r+=`
`,n.type!=="ImportStatement"&&(r+=`
`)),n.type){case"ExportStatement":r+=this.serializeExportStatement(n);break;case"ImportStatement":r+=this.serializeImportStatement(n);break}o++}return r+=`
`,r}serializeAliasDeclaration(e){let r=e.body.type==="Template"?e.body.expression:e.body,o="";if(o+="type ",o+=e.name,e.body.type==="Template"){o+="<";for(let n=0;n<e.body.params.length;n++)n>=1&&(o+=", "),o+=e.body.params[n];o+=">"}return o+=" = ",o+=this.serializeExpression(r),o+=";",o}serializeArrayExpression(e){let r=e.values.type==="InferClause"||e.values.type==="UnionExpression"&&e.values.args.length>=2,o="";return r&&(o+="("),o+=this.serializeExpression(e.values),r&&(o+=")"),o+="[]",o}serializeExportStatement(e){let r="";switch(r+="export ",e.argument.type){case"AliasDeclaration":r+=this.serializeAliasDeclaration(e.argument);break;case"InterfaceDeclaration":r+=this.serializeInterfaceDeclaration(e.argument);break;case"RuntimeEnumDeclaration":r+=this.serializeRuntimeEnum(e.argument);break}return r}serializeExpression(e){switch(e.type){case"ArrayExpression":return this.serializeArrayExpression(e);case"ExtendsClause":return this.serializeExtendsClause(e);case"GenericExpression":return this.serializeGenericExpression(e);case"Identifier":return this.serializeIdentifier(e);case"InferClause":return this.serializeInferClause(e);case"Literal":return this.serializeLiteral(e);case"MappedType":return this.serializeMappedType(e);case"ObjectExpression":return this.serializeObjectExpression(e);case"UnionExpression":return this.serializeUnionExpression(e)}}serializeExtendsClause(e){let r="";return r+=this.serializeExpression(e.checkType),r+=" extends ",r+=this.serializeExpression(e.extendsType),r+=`
  ? `,r+=this.serializeExpression(e.trueType),r+=`
  : `,r+=this.serializeExpression(e.falseType),r}serializeGenericExpression(e){let r="";r+=e.name,r+="<";for(let o=0;o<e.args.length;o++)o>=1&&(r+=", "),r+=this.serializeExpression(e.args[o]);return r+=">",r}serializeIdentifier(e){return e.name}serializeImportClause(e){let r="";return r+=e.name,e.alias&&(r+=" as ",r+=e.alias),r}serializeImportStatement(e){let r="",o=0;r+="import ",this.typeOnlyImports&&(r+="type "),r+="{";for(let n of e.imports)o>=1&&(r+=","),r+=" ",r+=this.serializeImportClause(n),o++;return r+=" } from ",r+=JSON.stringify(e.moduleName),r+=";",r}serializeInferClause(e){let r="";return r+="infer ",r+=e.name,r}serializeInterfaceDeclaration(e){let r="";return r+="interface ",r+=e.name,r+=" ",r+=this.serializeObjectExpression(e.body),r}serializeLiteral(e){return JSON.stringify(e.value)}serializeKey(e){return ku.test(e)?e:JSON.stringify(e)}serializeMappedType(e){let r="";return r+=`{
  [K in string]?: `,r+=this.serializeExpression(e.value),r+=`;
}`,r}serializeObjectExpression(e){let r="";if(r+="{",e.properties.length>0){r+=`
`;let o=[...e.properties].sort((n,s)=>n.key.localeCompare(s.key));for(let n of o)r+="  ",r+=this.serializeProperty(n)}return r+="}",r}serializeProperty(e){let r="";if(e.comment){r+=`/**
`;for(let o of e.comment.split(/\r?\n/))r+=`   *${o?` ${o}`:""}
`;r+=`   */
  `}return r+=this.serializeKey(e.key),r+=": ",r+=this.serializeExpression(e.value),r+=`;
`,r}serializeRuntimeEnum(e){let r="enum ";r+=e.name,r+=` {
`;let o=e.body.type==="UnionExpression"?e.body.args:[e.body];o.sort((n,s)=>n.value.localeCompare(s.value));for(let n of o)if(n.type==="Literal"&&typeof n.value=="string"){let s=this.serializeLiteral(n),a=this.camelCase?_t(n.value):n.value;r+="  ",r+=a,r+=" = ",r+=s,r+=",",r+=`
`}return r+="}",r}serializeUnionExpression(e){let r="",o=0,n=[...e.args].sort((s,a)=>s.type!=="Identifier"||a.type!=="Identifier"?0:s.name===void 0||s.name==="undefined"?1:a.name===void 0||a.name==="undefined"?-1:s.name===null||s.name==="null"?1:a.name===null||a.name==="null"||s.name<a.name?-1:s.name>a.name?1:0);for(let s of n)o>=1&&(r+=" | "),r+=this.serializeExpression(s),o++;return r}};var oi=class{async generate(e){let r=fn.performance.now();e.logger?.info("Introspecting database...");let o=await e.dialect.introspector.introspect({db:e.db});e.logger?.debug(),e.logger?.debug(`Found ${o.tables.length} public tables:`);for(let c of o.tables)e.logger?.debug(` - ${c.name}`);e.logger?.debug();let s=(e.transformer??new ri).transform({camelCase:!!e.camelCase,defaultSchema:e.schema,dialect:e.dialect,metadata:o,runtimeEnums:!!e.runtimeEnums}),u=(e.serializer??new ii({camelCase:!!e.camelCase,typeOnlyImports:e.typeOnlyImports})).serialize(s),d=e.outFile?`.${Yt.sep}${(0,Yt.relative)(process.cwd(),e.outFile)}`:null;if(e.print)console.log(),console.log(u);else if(d){let c=(0,Yt.parse)(d).dir;await hn.promises.mkdir(c,{recursive:!0}),await hn.promises.writeFile(d,u);let y=fn.performance.now(),f=Math.round(y-r),h=o.tables.length,x=h===1?"":"s";e.logger?.success(`Introspected ${h} table${x} and generated ${d} in ${f}ms.
`)}return u}};var ua=require("path");var ni=(0,ua.join)(process.cwd(),"node_modules","kysely-codegen","dist","db.d.ts"),Nn=2,Ht="env(DATABASE_URL)",Lu=["silent","info","warn","error","debug"],Zt=["postgres","mysql","sqlite","mssql","libsql","bun-sqlite"];var fo=[{description:"Use the Kysely CamelCasePlugin.",longName:"camel-case"},{description:`Set the SQL dialect. (values: [${Zt.join(", ")}])`,longName:"dialect"},{description:"Specify the path to an environment file to use.",longName:"env-file"},{description:"Exclude tables matching the specified glob pattern. (examples: users, *.table, secrets.*, *._*)",longName:"exclude-pattern"},{description:"Print this message.",longName:"help",shortName:"h"},{description:"Only include tables matching the specified glob pattern. (examples: users, *.table, secrets.*, *._*)",longName:"include-pattern"},{description:"Set the terminal log level. (values: [debug, info, warn, error, silent], default: warn)",longName:"log-level"},{description:"Skip generating types for PostgreSQL domains. (default: false)",longName:"no-domains"},{description:`Set the file build path. (default: ${ni})`,longName:"out-file"},{description:"Print the generated output to the terminal.",longName:"print"},{description:"Generate runtime enums instead of string unions.",longName:"runtime-enums"},{description:"Generate TypeScript 3.8+ `import type` syntax (default: true).",longName:"type-only-imports"},{description:`Set the database connection string URL. This may point to an environment variable. (default: ${Ht})`,longName:"url"},{description:"Set the default schema of the database connection.",longName:"schema"},{description:"Verify that the generated types are up-to-date. (default: false)",longName:"verify"}];var yn=class{async generate(e){let r=!!e.camelCase,o=e.excludePattern,n=e.includePattern,s=e.outFile,a=!!e.print,u=e.runtimeEnums,d=e.schema,c=e.typeOnlyImports,y=new Xt(e.logLevel),f=new dr,{connectionString:h,inferredDialectName:x}=f.parse({connectionString:e.url??Ht,dialectName:e.dialectName,envFile:e.envFile,logger:y});e.dialectName?y.info(`Using dialect '${e.dialectName}'.`):y.info(`No dialect specified. Assuming '${x}'.`);let be=new Yr().getDialect(e.dialectName??x),$e=await be.introspector.connect({connectionString:h,dialect:be});await new oi().generate({camelCase:r,db:$e,dialect:be,excludePattern:o,includePattern:n,logger:y,outFile:s,print:a,runtimeEnums:u,schema:d,typeOnlyImports:c,verify:e.verify}),await $e.destroy()}#e(e){switch(e){case"silent":return 0;case"info":return 1;case"error":return 3;case"debug":return 4;case"warn":return 2;default:return Nn}}#t(e){return!!e&&e!=="false"}#r(){let e=[],r=0;for(let{description:o,longName:n,shortName:s}of fo){let a=`  --${n}`;s&&(a+=`, -${s}`),a.length>r&&(r=a.length),e.push({description:o,line:a})}return e.map(({description:o,line:n})=>{let s=" ".repeat(r-n.length+2);return`${n}${s}${o}`})}#i(){let r=["","kysely-codegen [options]","",...this.#r(),""];console.info(r.join(`
`)),process.exit(0)}parseOptions(e,r){let o=(0,da.default)(e),n=o._,s=this.#t(o["camel-case"]),a=o.dialect,u=this.#t(o.domains),d=!!o.h||!!o.help||n.includes("-h")||n.includes("--help"),c=this.#e(o["log-level"]),y=o["out-file"]??(o.print?void 0:ni),f=this.#t(o.print),h=this.#t(o["runtime-enums"]),x=o.schema,F=this.#t(o["type-only-imports"]??!0),be=o.url??Ht,$e=this.#t(o.verify??!1);try{for(let k in o)if(k!=="_"&&!fo.some(ke=>[ke.shortName,ke.longName,...ke.longName.startsWith("no-")?[ke.longName.slice(3)]:[]].includes(k)))throw new RangeError(`Invalid flag: "${k}"`);if(d&&!r?.silent&&this.#i(),a&&!Zt.includes(a)){let k=Zt.join(", ");throw new RangeError(`Parameter '--dialect' must have one of the following values: ${k}`)}if(!be)throw new TypeError(`Parameter '--url' must be a valid connection string. Examples:

  --url=postgres://username:password@mydomain.com/database
  --url=env(DATABASE_URL)`)}catch(k){if(c>0)if(k instanceof Error){if(console.error(new Xt().serializeError(k.message)),c>=4)throw console.error(),k;process.exit(0)}else throw k}return{camelCase:s,dialectName:a,domains:u,envFile,excludePattern,includePattern,logLevel:c,outFile:y,print:f,runtimeEnums:h,schema:x,typeOnlyImports:F,url:be,verify:$e}}async run(e){let r=this.parseOptions(e);await this.generate(r)}};0&&(module.exports={Adapter,AliasDeclarationNode,ArrayExpressionNode,Cli,ColumnMetadata,ColumnType,ConnectionStringParser,DEFAULT_LOG_LEVEL,DEFAULT_OUT_FILE,DEFAULT_URL,DatabaseMetadata,Dialect,DialectManager,EnumCollection,ExportStatementNode,ExtendsClauseNode,FLAGS,GLOBAL_DEFINITIONS,GLOBAL_IMPORTS,Generator,GenericExpressionNode,IdentifierNode,ImportClauseNode,ImportStatementNode,InferClauseNode,InterfaceDeclarationNode,Introspector,JSON_ARRAY_DEFINITION,JSON_DEFINITION,JSON_OBJECT_DEFINITION,JSON_PRIMITIVE_DEFINITION,JSON_VALUE_DEFINITION,LOG_LEVEL_NAMES,LiteralNode,LogLevel,Logger,MappedTypeNode,ModuleReferenceNode,NodeType,ObjectExpressionNode,PropertyNode,RuntimeEnumDeclarationNode,Serializer,SqliteAdapter,SqliteDialect,SymbolCollection,SymbolType,TableMetadata,TemplateNode,Transformer,UnionExpressionNode,VALID_DIALECTS,toCamelCase,toPascalCase});
